#pragma once

#include "BBmacros.h"
#include "Position.h"

const PScore pawnTable[2][64] = {
	{
		S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,
		S(183, 269)   ,S(145, 266)   ,S(188, 207)   ,S(198, 158)   ,S(180, 159)   ,S(126, 210)   ,S(-68, 299)   ,S(-46, 320)   ,
		S(95, 294)    ,S(122, 270)   ,S(146, 221)   ,S(142, 173)   ,S(159, 175)   ,S(214, 209)   ,S(160, 250)   ,S(111, 270)   ,
		S(90, 249)    ,S(94, 230)    ,S(102, 209)   ,S(118, 176)   ,S(131, 189)   ,S(139, 198)   ,S(103, 225)   ,S(95, 229)    ,
		S(84, 222)    ,S(81, 212)    ,S(97, 194)    ,S(106, 184)   ,S(112, 189)   ,S(114, 197)   ,S(101, 201)   ,S(95, 204)    ,
		S(86, 211)    ,S(86, 205)    ,S(93, 202)    ,S(103, 198)   ,S(113, 213)   ,S(104, 216)   ,S(119, 193)   ,S(108, 191)   ,
		S(85, 222)    ,S(81, 212)    ,S(81, 212)    ,S(90, 216)    ,S(88, 236)    ,S(126, 231)   ,S(138, 204)   ,S(108, 183)   ,
		S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,
	},
	{
		S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,
		S(130, 321)   ,S(106, 326)   ,S(177, 287)   ,S(189, 208)   ,S(184, 192)   ,S(191, 181)   ,S(81, 261)    ,S(69, 269)    ,
		S(122, 310)   ,S(176, 296)   ,S(179, 259)   ,S(163, 209)   ,S(167, 183)   ,S(161, 217)   ,S(149, 244)   ,S(90, 271)    ,
		S(126, 244)   ,S(123, 236)   ,S(130, 216)   ,S(134, 197)   ,S(129, 196)   ,S(113, 210)   ,S(79, 236)    ,S(81, 244)    ,
		S(121, 213)   ,S(114, 212)   ,S(124, 199)   ,S(121, 198)   ,S(110, 192)   ,S(93, 206)    ,S(70, 217)    ,S(66, 225)    ,
		S(124, 203)   ,S(135, 195)   ,S(119, 212)   ,S(109, 214)   ,S(97, 208)    ,S(89, 208)    ,S(74, 213)    ,S(64, 218)    ,
		S(125, 201)   ,S(148, 199)   ,S(136, 224)   ,S(100, 235)   ,S(79, 226)    ,S(75, 224)    ,S(66, 225)    ,S(64, 228)    ,
		S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,S(103, 202)   ,
	},
};
const PScore knightTable[2][64] = {
	{
		S(235, 584)   ,S(325, 661)   ,S(298, 709)   ,S(406, 680)   ,S(454, 673)   ,S(318, 710)   ,S(323, 672)   ,S(298, 550)   ,
		S(457, 630)   ,S(457, 654)   ,S(503, 655)   ,S(521, 691)   ,S(517, 691)   ,S(547, 643)   ,S(450, 658)   ,S(476, 628)   ,
		S(443, 641)   ,S(471, 668)   ,S(484, 707)   ,S(491, 708)   ,S(523, 699)   ,S(512, 706)   ,S(466, 680)   ,S(451, 660)   ,
		S(472, 665)   ,S(478, 677)   ,S(488, 709)   ,S(483, 731)   ,S(483, 740)   ,S(495, 719)   ,S(475, 707)   ,S(472, 688)   ,
		S(462, 670)   ,S(473, 682)   ,S(472, 711)   ,S(471, 721)   ,S(477, 729)   ,S(482, 716)   ,S(491, 693)   ,S(471, 693)   ,
		S(437, 621)   ,S(449, 656)   ,S(445, 683)   ,S(457, 711)   ,S(456, 708)   ,S(444, 683)   ,S(447, 672)   ,S(437, 650)   ,
		S(420, 640)   ,S(427, 655)   ,S(433, 652)   ,S(441, 677)   ,S(436, 679)   ,S(429, 655)   ,S(420, 664)   ,S(425, 670)   ,
		S(407, 596)   ,S(431, 618)   ,S(427, 632)   ,S(429, 666)   ,S(426, 670)   ,S(423, 663)   ,S(420, 645)   ,S(386, 627)   ,
	},
	{
		S(263, 544)   ,S(335, 643)   ,S(334, 693)   ,S(434, 665)   ,S(437, 660)   ,S(288, 701)   ,S(309, 666)   ,S(266, 557)   ,
		S(449, 625)   ,S(447, 661)   ,S(508, 658)   ,S(558, 672)   ,S(521, 679)   ,S(524, 653)   ,S(455, 650)   ,S(464, 620)   ,
		S(427, 659)   ,S(487, 672)   ,S(489, 711)   ,S(507, 709)   ,S(521, 698)   ,S(502, 700)   ,S(493, 656)   ,S(450, 643)   ,
		S(461, 674)   ,S(483, 687)   ,S(491, 715)   ,S(498, 725)   ,S(495, 726)   ,S(494, 705)   ,S(478, 689)   ,S(472, 662)   ,
		S(470, 680)   ,S(475, 690)   ,S(483, 708)   ,S(481, 720)   ,S(483, 719)   ,S(478, 708)   ,S(477, 684)   ,S(472, 664)   ,
		S(415, 654)   ,S(441, 667)   ,S(452, 682)   ,S(452, 704)   ,S(454, 704)   ,S(442, 680)   ,S(442, 649)   ,S(423, 622)   ,
		S(412, 678)   ,S(400, 681)   ,S(424, 659)   ,S(432, 672)   ,S(438, 674)   ,S(427, 653)   ,S(411, 659)   ,S(412, 632)   ,
		S(377, 645)   ,S(402, 649)   ,S(412, 661)   ,S(408, 668)   ,S(425, 656)   ,S(428, 623)   ,S(421, 624)   ,S(400, 584)   ,
	},
};
const PScore bishopTable[2][64] = {
	{
		S(411, 751)   ,S(388, 754)   ,S(334, 755)   ,S(321, 765)   ,S(343, 753)   ,S(311, 752)   ,S(420, 733)   ,S(404, 740)   ,
		S(412, 740)   ,S(472, 734)   ,S(467, 731)   ,S(433, 740)   ,S(461, 731)   ,S(457, 736)   ,S(430, 745)   ,S(433, 729)   ,
		S(468, 732)   ,S(474, 738)   ,S(498, 732)   ,S(479, 729)   ,S(491, 732)   ,S(486, 755)   ,S(470, 747)   ,S(462, 747)   ,
		S(456, 734)   ,S(493, 728)   ,S(475, 730)   ,S(499, 749)   ,S(501, 754)   ,S(494, 739)   ,S(498, 739)   ,S(447, 747)   ,
		S(467, 715)   ,S(476, 720)   ,S(470, 746)   ,S(489, 743)   ,S(497, 747)   ,S(474, 741)   ,S(479, 728)   ,S(478, 714)   ,
		S(470, 711)   ,S(482, 720)   ,S(472, 733)   ,S(475, 737)   ,S(470, 736)   ,S(474, 733)   ,S(477, 716)   ,S(479, 722)   ,
		S(480, 703)   ,S(477, 692)   ,S(475, 708)   ,S(454, 725)   ,S(454, 728)   ,S(472, 712)   ,S(486, 709)   ,S(475, 689)   ,
		S(487, 699)   ,S(472, 715)   ,S(454, 717)   ,S(447, 713)   ,S(443, 724)   ,S(448, 730)   ,S(450, 716)   ,S(473, 699)   ,
	},
	{
		S(378, 750)   ,S(350, 744)   ,S(356, 746)   ,S(334, 754)   ,S(325, 759)   ,S(306, 755)   ,S(423, 740)   ,S(389, 760)   ,
		S(388, 734)   ,S(434, 749)   ,S(453, 740)   ,S(431, 734)   ,S(448, 734)   ,S(472, 733)   ,S(470, 741)   ,S(436, 730)   ,
		S(458, 746)   ,S(489, 743)   ,S(490, 741)   ,S(497, 734)   ,S(497, 723)   ,S(500, 737)   ,S(488, 734)   ,S(477, 735)   ,
		S(455, 735)   ,S(497, 734)   ,S(486, 742)   ,S(506, 746)   ,S(516, 743)   ,S(486, 728)   ,S(496, 730)   ,S(471, 736)   ,
		S(475, 719)   ,S(467, 731)   ,S(487, 738)   ,S(500, 743)   ,S(495, 744)   ,S(482, 735)   ,S(483, 716)   ,S(461, 716)   ,
		S(471, 719)   ,S(483, 722)   ,S(485, 734)   ,S(485, 727)   ,S(477, 732)   ,S(477, 725)   ,S(477, 711)   ,S(460, 713)   ,
		S(472, 715)   ,S(496, 701)   ,S(477, 715)   ,S(460, 724)   ,S(457, 721)   ,S(461, 708)   ,S(465, 696)   ,S(474, 683)   ,
		S(482, 702)   ,S(452, 714)   ,S(449, 725)   ,S(445, 715)   ,S(447, 713)   ,S(452, 713)   ,S(466, 712)   ,S(479, 697)   ,
	},
};
const PScore rookTable[2][64] = {
	{
		S(627, 1308)  ,S(621, 1311)  ,S(590, 1323)  ,S(600, 1314)  ,S(594, 1323)  ,S(646, 1320)  ,S(638, 1321)  ,S(643, 1314)  ,
		S(608, 1299)  ,S(594, 1311)  ,S(618, 1306)  ,S(635, 1304)  ,S(620, 1310)  ,S(657, 1287)  ,S(616, 1303)  ,S(622, 1292)  ,
		S(600, 1287)  ,S(652, 1268)  ,S(628, 1283)  ,S(663, 1262)  ,S(678, 1256)  ,S(683, 1269)  ,S(704, 1251)  ,S(631, 1275)  ,
		S(600, 1275)  ,S(622, 1271)  ,S(632, 1272)  ,S(662, 1259)  ,S(650, 1265)  ,S(661, 1262)  ,S(649, 1268)  ,S(627, 1268)  ,
		S(578, 1259)  ,S(583, 1277)  ,S(584, 1272)  ,S(600, 1261)  ,S(592, 1266)  ,S(601, 1272)  ,S(624, 1266)  ,S(597, 1249)  ,
		S(575, 1233)  ,S(585, 1251)  ,S(575, 1247)  ,S(596, 1236)  ,S(591, 1238)  ,S(595, 1242)  ,S(625, 1231)  ,S(595, 1209)  ,
		S(558, 1229)  ,S(588, 1227)  ,S(587, 1233)  ,S(596, 1225)  ,S(595, 1224)  ,S(609, 1217)  ,S(620, 1206)  ,S(546, 1225)  ,
		S(596, 1227)  ,S(596, 1233)  ,S(599, 1235)  ,S(607, 1225)  ,S(606, 1226)  ,S(610, 1243)  ,S(606, 1233)  ,S(595, 1206)  ,
	},
	{
		S(637, 1307)  ,S(597, 1329)  ,S(615, 1327)  ,S(612, 1313)  ,S(622, 1304)  ,S(624, 1301)  ,S(655, 1290)  ,S(654, 1293)  ,
		S(585, 1307)  ,S(609, 1309)  ,S(639, 1301)  ,S(630, 1301)  ,S(633, 1295)  ,S(645, 1280)  ,S(611, 1293)  ,S(625, 1287)  ,
		S(594, 1294)  ,S(658, 1271)  ,S(646, 1286)  ,S(669, 1260)  ,S(683, 1246)  ,S(652, 1264)  ,S(683, 1248)  ,S(626, 1272)  ,
		S(590, 1279)  ,S(635, 1271)  ,S(651, 1269)  ,S(655, 1258)  ,S(654, 1255)  ,S(640, 1261)  ,S(642, 1256)  ,S(625, 1264)  ,
		S(560, 1247)  ,S(600, 1263)  ,S(591, 1272)  ,S(592, 1265)  ,S(593, 1257)  ,S(587, 1268)  ,S(593, 1270)  ,S(585, 1253)  ,
		S(549, 1219)  ,S(594, 1233)  ,S(596, 1235)  ,S(587, 1232)  ,S(586, 1232)  ,S(583, 1239)  ,S(602, 1238)  ,S(581, 1221)  ,
		S(457, 1247)  ,S(572, 1217)  ,S(591, 1224)  ,S(588, 1225)  ,S(593, 1218)  ,S(594, 1216)  ,S(597, 1212)  ,S(553, 1213)  ,
		S(549, 1231)  ,S(575, 1244)  ,S(605, 1232)  ,S(606, 1226)  ,S(604, 1218)  ,S(602, 1223)  ,S(608, 1218)  ,S(595, 1211)  ,
	},
};
const PScore queenTable[2][64] = {
	{
		S(1221, 1423) ,S(1255, 1414) ,S(1233, 1454) ,S(1239, 1462) ,S(1227, 1490) ,S(1262, 1491) ,S(1261, 1461) ,S(1250, 1435) ,
		S(1249, 1400) ,S(1194, 1447) ,S(1245, 1421) ,S(1187, 1487) ,S(1189, 1529) ,S(1269, 1503) ,S(1185, 1505) ,S(1265, 1441) ,
		S(1252, 1399) ,S(1257, 1392) ,S(1246, 1415) ,S(1254, 1432) ,S(1263, 1470) ,S(1270, 1484) ,S(1263, 1488) ,S(1244, 1506) ,
		S(1265, 1384) ,S(1265, 1418) ,S(1257, 1406) ,S(1241, 1476) ,S(1242, 1500) ,S(1277, 1495) ,S(1287, 1487) ,S(1284, 1460) ,
		S(1269, 1360) ,S(1271, 1409) ,S(1260, 1422) ,S(1253, 1471) ,S(1256, 1469) ,S(1273, 1458) ,S(1285, 1433) ,S(1288, 1417) ,
		S(1274, 1342) ,S(1280, 1372) ,S(1271, 1405) ,S(1268, 1399) ,S(1270, 1390) ,S(1274, 1414) ,S(1290, 1377) ,S(1288, 1350) ,
		S(1278, 1331) ,S(1281, 1336) ,S(1289, 1324) ,S(1283, 1358) ,S(1285, 1345) ,S(1303, 1290) ,S(1292, 1293) ,S(1259, 1342) ,
		S(1279, 1321) ,S(1283, 1323) ,S(1288, 1323) ,S(1295, 1351) ,S(1295, 1312) ,S(1269, 1310) ,S(1267, 1284) ,S(1264, 1303) ,
	},
	{
		S(1261, 1374) ,S(1264, 1401) ,S(1252, 1439) ,S(1245, 1471) ,S(1230, 1468) ,S(1251, 1433) ,S(1246, 1411) ,S(1252, 1390) ,
		S(1244, 1412) ,S(1183, 1464) ,S(1254, 1459) ,S(1184, 1515) ,S(1170, 1529) ,S(1248, 1425) ,S(1200, 1450) ,S(1269, 1384) ,
		S(1250, 1441) ,S(1253, 1439) ,S(1242, 1464) ,S(1267, 1454) ,S(1269, 1429) ,S(1253, 1432) ,S(1281, 1381) ,S(1282, 1394) ,
		S(1269, 1418) ,S(1281, 1461) ,S(1270, 1454) ,S(1262, 1480) ,S(1256, 1467) ,S(1271, 1406) ,S(1286, 1415) ,S(1290, 1390) ,
		S(1276, 1380) ,S(1280, 1428) ,S(1272, 1438) ,S(1266, 1465) ,S(1269, 1446) ,S(1269, 1416) ,S(1284, 1390) ,S(1278, 1363) ,
		S(1252, 1371) ,S(1280, 1368) ,S(1278, 1403) ,S(1275, 1380) ,S(1276, 1381) ,S(1279, 1387) ,S(1286, 1362) ,S(1281, 1326) ,
		S(1234, 1336) ,S(1269, 1305) ,S(1300, 1285) ,S(1293, 1333) ,S(1288, 1346) ,S(1295, 1305) ,S(1294, 1314) ,S(1290, 1298) ,
		S(1239, 1310) ,S(1265, 1278) ,S(1271, 1278) ,S(1288, 1294) ,S(1294, 1313) ,S(1297, 1288) ,S(1297, 1302) ,S(1289, 1287) ,
	},
};
const PScore kingTable[2][64] = {
	{
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(83, -44)    ,S(72, -42)    ,S(62, -39)    ,S(-22, -203)  ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(149, 12)    ,S(153, 31)    ,S(73, 63)     ,S(-3, -38)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(166, 46)    ,S(221, 56)    ,S(168, 59)    ,S(37, 8)      ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(106, 77)    ,S(130, 70)    ,S(107, 50)    ,S(-50, 16)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(68, 80)     ,S(69, 63)     ,S(66, 29)     ,S(-65, -9)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(20, 60)     ,S(18, 41)     ,S(13, 8)      ,S(-55, -12)   ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-65, 36)    ,S(-51, 31)    ,S(-4, -9)     ,S(-1, -51)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-65, -41)   ,S(-90, -6)    ,S(-1, -52)    ,S(6, -138)    ,
	},
	{
		S(-13, -215)  ,S(48, -87)    ,S(85, -73)    ,S(110, -49)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-38, -54)   ,S(88, 31)     ,S(146, 13)    ,S(184, -13)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(11, 4)      ,S(166, 41)    ,S(194, 41)    ,S(169, 34)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-47, 11)    ,S(110, 31)    ,S(131, 54)    ,S(104, 61)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-55, -31)   ,S(60, 13)     ,S(100, 41)    ,S(60, 65)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-80, -18)   ,S(1, -2)      ,S(27, 22)     ,S(11, 45)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-18, -43)   ,S(-17, -20)   ,S(-24, 6)     ,S(-73, 19)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-29, -122)  ,S(-11, -66)   ,S(-49, -26)   ,S(-92, -40)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
};

constexpr PScore materialValues[5] = {S(103, 202), S(423, 632), S(438, 680), S(592, 1219), S(1261, 1370), };
constexpr PScore knightMob[9] = {S(-27, -128), S(-9, -53), S(4, -5), S(10, 20), S(15, 30), S(21, 44), S(28, 42), S(37, 35), S(50, 10), };
constexpr PScore bishopMob[14] = {S(-47, -184), S(-18, -107), S(-1, -53), S(7, -25), S(17, -5), S(23, 14), S(25, 27), S(23, 35), S(23, 44), S(25, 47), S(32, 40), S(54, 27), S(58, 32), S(81, -10), };
constexpr PScore rookMob[15] = {S(-20, -142), S(-26, -95), S(-17, -62), S(-15, -46), S(-14, -27), S(-16, -9), S(-14, 0), S(-8, 1), S(-5, 6), S(3, 10), S(5, 17), S(10, 20), S(13, 22), S(30, 0), S(92, -34), };
constexpr PScore queenMob[28] = {S(-127, -446), S(-83, -479), S(-44, -390), S(-26, -303), S(-23, -207), S(-20, -150), S(-16, -114), S(-13, -94), S(-10, -73), S(-7, -62), S(-3, -53), S(2, -49), S(6, -46), S(9, -43), S(11, -43), S(12, -44), S(11, -45), S(8, -43), S(10, -48), S(14, -58), S(27, -82), S(34, -101), S(34, -116), S(47, -142), S(22, -145), S(27, -166), S(-7, -130), S(-4, -113), };

constexpr Score gamephaseInc[12] = { 0, 1, 1, 2, 4, 0, 0, 1, 1, 2, 4, 0 };

//constexpr Score KSAMG = -2;
constexpr double KSCALEMG = 828.1849365234375;
constexpr double KSBMG = 1; 
constexpr double KSCMG = -3.2165298461914062;
// constexpr Score KSAEG = -71;
constexpr double KSCALEEG = 1071.4842529296875;
constexpr double KSBEG = 1;
constexpr double KSCEG = 2.036797046661377;

#define PAWNHASHSIZE 262144ULL

struct PawnEvalHashEntry {
    U64 hash;
    PScore score;
    BitBoard passers; // This can be shrinked to add more stuff and keep the alignement
};

extern PawnEvalHashEntry pawnEvalHash[PAWNHASHSIZE];

extern PScore PSQTs[2][12][64];
/**
* @brief The initTables function initializes the material - positional tables
* @note This function is called once at the beginning of the program
*/
void initTables();

/**
 * @brief The pestoEval function evaluates the material and positional scores
 * @param pos The position to evaluate
 * @return The material and positional scores
 */
Score pestoEval(Position* pos);

/** 
 * @brief The initTropism function initializes the tropism tables
 * @note This is called at the start of the program 
 */
void initTropism();

/**
 * @brief The convertToFeatures function converts a set of positions to a set of features
 * @param filename The filename of the epd file
 * @param output The output file to write the features to
 */
void convertToFeatures(std::string filename, std::string output);