#pragma once

#include "BBmacros.h"
#include "Position.h"
const PScore pawnTable[2][64] = {
	{
		S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,
		S(226, 266)   ,S(176, 268)   ,S(218, 215)   ,S(226, 174)   ,S(200, 185)   ,S(143, 236)   ,S(-69, 326)   ,S(-23, 333)   ,
		S(106, 286)   ,S(125, 264)   ,S(143, 221)   ,S(138, 179)   ,S(143, 190)   ,S(204, 232)   ,S(140, 269)   ,S(118, 276)   ,
		S(100, 241)   ,S(104, 223)   ,S(109, 205)   ,S(119, 180)   ,S(130, 199)   ,S(136, 209)   ,S(103, 235)   ,S(98, 234)    ,
		S(91, 219)    ,S(90, 212)    ,S(104, 195)   ,S(111, 189)   ,S(113, 199)   ,S(117, 208)   ,S(102, 212)   ,S(98, 206)    ,
		S(94, 207)    ,S(95, 202)    ,S(101, 201)   ,S(107, 197)   ,S(120, 215)   ,S(112, 220)   ,S(125, 198)   ,S(112, 190)   ,
		S(91, 213)    ,S(91, 202)    ,S(90, 205)    ,S(98, 207)    ,S(98, 227)    ,S(137, 220)   ,S(145, 192)   ,S(114, 171)   ,
		S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,
	},
	{
		S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,
		S(152, 332)   ,S(116, 342)   ,S(192, 305)   ,S(210, 228)   ,S(205, 214)   ,S(222, 192)   ,S(107, 263)   ,S(105, 268)   ,
		S(125, 309)   ,S(164, 306)   ,S(158, 276)   ,S(148, 224)   ,S(157, 195)   ,S(156, 225)   ,S(145, 244)   ,S(101, 266)   ,
		S(131, 240)   ,S(125, 239)   ,S(128, 223)   ,S(130, 206)   ,S(130, 202)   ,S(116, 212)   ,S(88, 236)    ,S(89, 240)    ,
		S(126, 209)   ,S(114, 218)   ,S(124, 206)   ,S(124, 205)   ,S(111, 198)   ,S(99, 212)    ,S(79, 222)    ,S(72, 225)    ,
		S(130, 197)   ,S(141, 193)   ,S(125, 214)   ,S(116, 215)   ,S(104, 209)   ,S(95, 212)    ,S(82, 216)    ,S(71, 215)    ,
		S(132, 188)   ,S(157, 186)   ,S(144, 212)   ,S(110, 223)   ,S(88, 216)    ,S(85, 218)    ,S(76, 215)    ,S(73, 218)    ,
		S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,S(108, 202)   ,
	},
};
const PScore knightTable[2][64] = {
	{
		S(286, 603)   ,S(379, 677)   ,S(366, 723)   ,S(477, 695)   ,S(516, 692)   ,S(390, 728)   ,S(384, 690)   ,S(346, 577)   ,
		S(490, 654)   ,S(496, 675)   ,S(533, 678)   ,S(555, 716)   ,S(564, 716)   ,S(574, 671)   ,S(491, 682)   ,S(509, 659)   ,
		S(484, 663)   ,S(505, 686)   ,S(537, 722)   ,S(539, 727)   ,S(551, 723)   ,S(547, 729)   ,S(483, 714)   ,S(495, 685)   ,
		S(524, 681)   ,S(534, 689)   ,S(547, 722)   ,S(546, 751)   ,S(552, 762)   ,S(551, 739)   ,S(528, 732)   ,S(522, 714)   ,
		S(513, 688)   ,S(527, 696)   ,S(529, 722)   ,S(532, 738)   ,S(539, 748)   ,S(533, 735)   ,S(542, 718)   ,S(514, 719)   ,
		S(488, 641)   ,S(500, 671)   ,S(500, 699)   ,S(510, 727)   ,S(506, 727)   ,S(496, 701)   ,S(491, 692)   ,S(481, 672)   ,
		S(465, 664)   ,S(476, 677)   ,S(480, 669)   ,S(487, 695)   ,S(484, 698)   ,S(472, 676)   ,S(463, 687)   ,S(467, 691)   ,
		S(452, 621)   ,S(478, 639)   ,S(472, 653)   ,S(476, 685)   ,S(471, 687)   ,S(468, 679)   ,S(467, 659)   ,S(428, 648)   ,
	},
	{
		S(309, 569)   ,S(392, 664)   ,S(395, 710)   ,S(492, 689)   ,S(501, 678)   ,S(352, 717)   ,S(363, 683)   ,S(311, 584)   ,
		S(485, 652)   ,S(478, 688)   ,S(531, 684)   ,S(594, 697)   ,S(567, 702)   ,S(557, 674)   ,S(498, 669)   ,S(500, 644)   ,
		S(463, 685)   ,S(510, 697)   ,S(522, 730)   ,S(549, 728)   ,S(558, 719)   ,S(552, 714)   ,S(526, 676)   ,S(489, 664)   ,
		S(509, 697)   ,S(534, 707)   ,S(547, 733)   ,S(563, 744)   ,S(563, 742)   ,S(554, 719)   ,S(535, 706)   ,S(525, 678)   ,
		S(515, 703)   ,S(524, 712)   ,S(535, 725)   ,S(542, 737)   ,S(543, 736)   ,S(534, 721)   ,S(529, 702)   ,S(521, 685)   ,
		S(459, 675)   ,S(484, 686)   ,S(500, 701)   ,S(502, 723)   ,S(505, 720)   ,S(497, 697)   ,S(493, 669)   ,S(473, 645)   ,
		S(455, 697)   ,S(444, 701)   ,S(465, 680)   ,S(477, 693)   ,S(484, 693)   ,S(474, 673)   ,S(458, 680)   ,S(457, 658)   ,
		S(417, 668)   ,S(449, 666)   ,S(459, 677)   ,S(455, 685)   ,S(471, 675)   ,S(473, 646)   ,S(467, 643)   ,S(441, 610)   ,
	},
};
const PScore bishopTable[2][64] = {
	{
		S(466, 767)   ,S(443, 763)   ,S(388, 760)   ,S(378, 768)   ,S(397, 753)   ,S(372, 752)   ,S(467, 741)   ,S(458, 752)   ,
		S(457, 753)   ,S(488, 753)   ,S(503, 738)   ,S(465, 749)   ,S(471, 742)   ,S(492, 736)   ,S(455, 752)   ,S(468, 743)   ,
		S(519, 743)   ,S(514, 745)   ,S(528, 741)   ,S(508, 737)   ,S(516, 735)   ,S(505, 760)   ,S(492, 753)   ,S(498, 758)   ,
		S(502, 747)   ,S(524, 739)   ,S(513, 732)   ,S(527, 749)   ,S(523, 756)   ,S(516, 746)   ,S(518, 754)   ,S(488, 754)   ,
		S(507, 730)   ,S(518, 726)   ,S(515, 742)   ,S(519, 743)   ,S(528, 747)   ,S(512, 747)   ,S(514, 737)   ,S(506, 730)   ,
		S(513, 722)   ,S(530, 727)   ,S(516, 738)   ,S(515, 742)   ,S(513, 743)   ,S(512, 739)   ,S(517, 732)   ,S(511, 735)   ,
		S(526, 713)   ,S(524, 699)   ,S(518, 717)   ,S(502, 732)   ,S(500, 735)   ,S(515, 717)   ,S(529, 712)   ,S(514, 699)   ,
		S(532, 709)   ,S(517, 730)   ,S(499, 737)   ,S(493, 728)   ,S(489, 736)   ,S(494, 740)   ,S(494, 724)   ,S(516, 705)   ,
	},
	{
		S(433, 759)   ,S(404, 752)   ,S(412, 748)   ,S(390, 754)   ,S(376, 760)   ,S(362, 758)   ,S(471, 748)   ,S(443, 768)   ,
		S(427, 750)   ,S(462, 759)   ,S(488, 743)   ,S(460, 738)   ,S(464, 743)   ,S(505, 735)   ,S(501, 749)   ,S(479, 738)   ,
		S(497, 759)   ,S(511, 753)   ,S(511, 746)   ,S(522, 740)   ,S(525, 728)   ,S(531, 741)   ,S(527, 737)   ,S(522, 745)   ,
		S(486, 749)   ,S(522, 743)   ,S(505, 749)   ,S(526, 751)   ,S(543, 742)   ,S(521, 725)   ,S(525, 739)   ,S(515, 741)   ,
		S(507, 733)   ,S(496, 739)   ,S(520, 740)   ,S(530, 744)   ,S(528, 739)   ,S(526, 732)   ,S(527, 718)   ,S(499, 728)   ,
		S(502, 733)   ,S(517, 732)   ,S(520, 739)   ,S(525, 734)   ,S(518, 735)   ,S(520, 727)   ,S(524, 721)   ,S(506, 721)   ,
		S(506, 726)   ,S(535, 705)   ,S(518, 720)   ,S(506, 730)   ,S(503, 727)   ,S(506, 717)   ,S(512, 703)   ,S(520, 694)   ,
		S(523, 710)   ,S(494, 724)   ,S(496, 734)   ,S(491, 725)   ,S(492, 725)   ,S(497, 729)   ,S(509, 726)   ,S(524, 708)   ,
	},
};
const PScore rookTable[2][64] = {
	{
		S(687, 1290)  ,S(681, 1293)  ,S(647, 1306)  ,S(659, 1299)  ,S(631, 1314)  ,S(692, 1308)  ,S(696, 1305)  ,S(690, 1302)  ,
		S(667, 1279)  ,S(656, 1291)  ,S(677, 1284)  ,S(696, 1283)  ,S(666, 1299)  ,S(701, 1277)  ,S(673, 1287)  ,S(672, 1278)  ,
		S(657, 1265)  ,S(714, 1245)  ,S(689, 1261)  ,S(723, 1240)  ,S(724, 1243)  ,S(727, 1258)  ,S(749, 1238)  ,S(677, 1263)  ,
		S(659, 1252)  ,S(681, 1248)  ,S(689, 1249)  ,S(717, 1240)  ,S(696, 1255)  ,S(702, 1253)  ,S(691, 1258)  ,S(672, 1257)  ,
		S(633, 1240)  ,S(638, 1258)  ,S(637, 1254)  ,S(653, 1246)  ,S(638, 1259)  ,S(644, 1264)  ,S(662, 1260)  ,S(636, 1244)  ,
		S(628, 1213)  ,S(642, 1227)  ,S(632, 1224)  ,S(652, 1213)  ,S(642, 1224)  ,S(646, 1228)  ,S(674, 1217)  ,S(641, 1197)  ,
		S(609, 1209)  ,S(641, 1205)  ,S(640, 1211)  ,S(651, 1204)  ,S(645, 1211)  ,S(658, 1205)  ,S(669, 1192)  ,S(591, 1209)  ,
		S(647, 1204)  ,S(650, 1211)  ,S(653, 1211)  ,S(661, 1201)  ,S(656, 1207)  ,S(661, 1224)  ,S(654, 1213)  ,S(643, 1187)  ,
	},
	{
		S(688, 1290)  ,S(656, 1311)  ,S(663, 1313)  ,S(647, 1303)  ,S(677, 1291)  ,S(681, 1283)  ,S(716, 1272)  ,S(714, 1276)  ,
		S(632, 1291)  ,S(664, 1291)  ,S(689, 1283)  ,S(678, 1283)  ,S(695, 1274)  ,S(702, 1261)  ,S(671, 1274)  ,S(682, 1268)  ,
		S(639, 1279)  ,S(710, 1253)  ,S(692, 1269)  ,S(716, 1242)  ,S(739, 1229)  ,S(708, 1246)  ,S(741, 1228)  ,S(682, 1254)  ,
		S(631, 1265)  ,S(680, 1256)  ,S(689, 1259)  ,S(696, 1247)  ,S(706, 1237)  ,S(694, 1238)  ,S(697, 1234)  ,S(679, 1242)  ,
		S(598, 1240)  ,S(639, 1254)  ,S(628, 1264)  ,S(636, 1255)  ,S(643, 1244)  ,S(638, 1251)  ,S(643, 1252)  ,S(637, 1236)  ,
		S(595, 1203)  ,S(646, 1216)  ,S(647, 1216)  ,S(638, 1213)  ,S(642, 1212)  ,S(638, 1216)  ,S(656, 1218)  ,S(633, 1203)  ,
		S(506, 1225)  ,S(624, 1195)  ,S(640, 1206)  ,S(639, 1207)  ,S(646, 1200)  ,S(646, 1197)  ,S(649, 1192)  ,S(602, 1195)  ,
		S(596, 1209)  ,S(625, 1220)  ,S(654, 1210)  ,S(656, 1203)  ,S(656, 1196)  ,S(654, 1201)  ,S(659, 1197)  ,S(648, 1188)  ,
	},
};
const PScore queenTable[2][64] = {
	{
		S(1333, 2255) ,S(1361, 2253) ,S(1341, 2284) ,S(1347, 2293) ,S(1325, 2313) ,S(1369, 2303) ,S(1386, 2284) ,S(1370, 2263) ,
		S(1355, 2237) ,S(1294, 2291) ,S(1347, 2260) ,S(1288, 2322) ,S(1273, 2361) ,S(1368, 2305) ,S(1303, 2331) ,S(1364, 2279) ,
		S(1356, 2236) ,S(1357, 2233) ,S(1343, 2257) ,S(1347, 2271) ,S(1347, 2286) ,S(1340, 2313) ,S(1332, 2313) ,S(1332, 2332) ,
		S(1368, 2220) ,S(1362, 2260) ,S(1353, 2246) ,S(1327, 2316) ,S(1320, 2336) ,S(1351, 2327) ,S(1363, 2322) ,S(1370, 2290) ,
		S(1371, 2209) ,S(1376, 2249) ,S(1359, 2264) ,S(1345, 2322) ,S(1342, 2315) ,S(1360, 2297) ,S(1370, 2268) ,S(1377, 2257) ,
		S(1380, 2184) ,S(1388, 2208) ,S(1374, 2245) ,S(1369, 2238) ,S(1369, 2228) ,S(1369, 2251) ,S(1388, 2212) ,S(1383, 2189) ,
		S(1384, 2168) ,S(1387, 2174) ,S(1394, 2159) ,S(1388, 2195) ,S(1389, 2181) ,S(1407, 2120) ,S(1394, 2129) ,S(1359, 2177) ,
		S(1386, 2158) ,S(1386, 2161) ,S(1393, 2160) ,S(1401, 2186) ,S(1400, 2148) ,S(1377, 2140) ,S(1372, 2122) ,S(1369, 2133) ,
	},
	{
		S(1360, 2211) ,S(1358, 2256) ,S(1359, 2266) ,S(1353, 2288) ,S(1346, 2289) ,S(1371, 2251) ,S(1366, 2231) ,S(1364, 2225) ,
		S(1331, 2248) ,S(1276, 2303) ,S(1339, 2294) ,S(1268, 2348) ,S(1264, 2365) ,S(1352, 2244) ,S(1307, 2284) ,S(1375, 2218) ,
		S(1333, 2271) ,S(1318, 2277) ,S(1312, 2296) ,S(1347, 2278) ,S(1356, 2263) ,S(1352, 2256) ,S(1377, 2213) ,S(1379, 2230) ,
		S(1344, 2252) ,S(1351, 2295) ,S(1336, 2289) ,S(1332, 2314) ,S(1339, 2297) ,S(1361, 2232) ,S(1377, 2247) ,S(1386, 2220) ,
		S(1361, 2212) ,S(1358, 2260) ,S(1352, 2268) ,S(1348, 2299) ,S(1357, 2283) ,S(1365, 2252) ,S(1384, 2223) ,S(1376, 2205) ,
		S(1345, 2198) ,S(1372, 2187) ,S(1370, 2225) ,S(1371, 2208) ,S(1375, 2212) ,S(1379, 2221) ,S(1390, 2200) ,S(1382, 2168) ,
		S(1331, 2160) ,S(1368, 2124) ,S(1400, 2105) ,S(1394, 2159) ,S(1389, 2174) ,S(1399, 2134) ,S(1398, 2145) ,S(1392, 2138) ,
		S(1339, 2132) ,S(1365, 2109) ,S(1377, 2096) ,S(1392, 2120) ,S(1398, 2139) ,S(1399, 2119) ,S(1397, 2134) ,S(1391, 2120) ,
	},
};
const PScore kingTable[2][64] = {
	{
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(100, -42)   ,S(61, -28)    ,S(80, -40)    ,S(-4, -166)   ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(149, 19)    ,S(170, 31)    ,S(84, 61)     ,S(28, -8)     ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(153, 48)    ,S(221, 54)    ,S(160, 59)    ,S(74, 29)     ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(81, 75)     ,S(109, 67)    ,S(80, 49)     ,S(-28, 34)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(24, 72)     ,S(35, 52)     ,S(28, 23)     ,S(-31, 1)     ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-18, 54)    ,S(-8, 34)     ,S(-21, 5)     ,S(2, -1)      ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-90, 29)    ,S(-72, 28)    ,S(-18, -12)   ,S(54, -27)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-76, -46)   ,S(-97, -5)    ,S(-7, -53)    ,S(48, -102)   ,
	},
	{
		S(5, -205)    ,S(65, -74)    ,S(107, -63)   ,S(119, -37)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-30, -45)   ,S(100, 39)    ,S(158, 21)    ,S(199, -6)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(3, 9)       ,S(162, 49)    ,S(183, 48)    ,S(157, 38)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-57, 14)    ,S(92, 36)     ,S(108, 59)    ,S(84, 62)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-77, -28)   ,S(22, 17)     ,S(67, 38)     ,S(24, 60)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-89, -21)   ,S(-26, -3)    ,S(-1, 20)     ,S(-21, 39)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-9, -50)    ,S(-23, -24)   ,S(-34, 2)     ,S(-92, 13)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-13, -128)  ,S(-6, -68)    ,S(-46, -25)   ,S(-97, -44)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
};

constexpr PScore materialValues[5] = {S(108, 202), S(469, 649), S(475, 686), S(641, 1201), S(1360, 2192), };
constexpr PScore knightMob[9] = {S(-41, -155), S(-22, -80), S(-10, -32), S(-5, -6), S(1, 5), S(7, 20), S(14, 21), S(25, 17), S(35, -6), };
constexpr PScore bishopMob[14] = {S(-58, -205), S(-30, -132), S(-15, -80), S(-7, -50), S(5, -29), S(8, -7), S(11, 7), S(12, 16), S(14, 27), S(20, 29), S(30, 23), S(55, 9), S(67, 13), S(88, -27), };
constexpr PScore rookMob[15] = {S(-27, -139), S(-33, -96), S(-25, -62), S(-23, -45), S(-23, -27), S(-24, -7), S(-21, 2), S(-15, 5), S(-12, 11), S(-4, 16), S(-5, 23), S(0, 28), S(4, 31), S(19, 13), S(83, -21), };
constexpr PScore queenMob[28] = {S(-148, -380), S(-106, -398), S(-68, -313), S(-50, -224), S(-48, -129), S(-45, -71), S(-41, -35), S(-37, -16), S(-34, 5), S(-30, 18), S(-26, 27), S(-22, 33), S(-18, 35), S(-13, 38), S(-12, 39), S(-10, 38), S(-10, 36), S(-14, 35), S(-10, 28), S(-5, 15), S(6, -9), S(15, -34), S(14, -51), S(26, -77), S(1, -84), S(3, -112), S(-34, -78), S(-26, -65), };

constexpr Score gamephaseInc[12] = { 0, 1, 1, 2, 4, 0, 0, 1, 1, 2, 4, 0 };

//constexpr Score KSAMG = -2;
constexpr double KSCALEMG = 902.352783203125;
constexpr double KSBMG = 1; 
constexpr double KSCMG = -2.6307013034820557;
// constexpr Score KSAEG = -71;
constexpr double KSCALEEG = 326.9881591796875;
constexpr double KSBEG = 1;
constexpr double KSCEG = -0.5023094415664673;

#define PAWNHASHSIZE 262144ULL

struct PawnEvalHashEntry {
    U64 hash;
    PScore score;
    BitBoard passers; // This can be shrinked to add more stuff and keep the alignement
};

extern PawnEvalHashEntry pawnEvalHash[PAWNHASHSIZE];

extern PScore PSQTs[2][12][64];
/**
* @brief The initTables function initializes the material - positional tables
* @note This function is called once at the beginning of the program
*/
void initTables();

/**
 * @brief The pestoEval function evaluates the material and positional scores
 * @param pos The position to evaluate
 * @return The material and positional scores
 */
Score pestoEval(Position* pos);

/** 
 * @brief The initTropism function initializes the tropism tables
 * @note This is called at the start of the program 
 */
void initTropism();

/**
 * @brief The convertToFeatures function converts a set of positions to a set of features
 * @param filename The filename of the epd file
 * @param output The output file to write the features to
 */
void convertToFeatures(std::string filename, std::string output);