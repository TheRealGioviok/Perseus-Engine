#pragma once

#include "BBmacros.h"
#include "Position.h"

const PScore pawnTable[2][64] = {
	{
		S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,
		S(226, 321)   ,S(181, 322)   ,S(223, 267)   ,S(230, 222)   ,S(210, 229)   ,S(154, 279)   ,S(-50, 371)   ,S(-17, 382)   ,
		S(95, 301)    ,S(121, 280)   ,S(143, 235)   ,S(136, 191)   ,S(150, 202)   ,S(203, 237)   ,S(149, 278)   ,S(107, 285)   ,
		S(91, 254)    ,S(94, 237)    ,S(100, 217)   ,S(116, 188)   ,S(126, 202)   ,S(133, 217)   ,S(97, 243)    ,S(93, 240)    ,
		S(85, 226)    ,S(80, 219)    ,S(96, 201)    ,S(104, 193)   ,S(109, 200)   ,S(112, 208)   ,S(97, 212)    ,S(95, 210)    ,
		S(87, 216)    ,S(85, 210)    ,S(92, 208)    ,S(101, 204)   ,S(112, 220)   ,S(104, 223)   ,S(118, 198)   ,S(107, 194)   ,
		S(84, 225)    ,S(81, 216)    ,S(81, 217)    ,S(89, 221)    ,S(88, 242)    ,S(126, 235)   ,S(137, 208)   ,S(108, 185)   ,
		S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,
	},
	{
		S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,
		S(165, 381)   ,S(131, 391)   ,S(212, 350)   ,S(219, 277)   ,S(213, 261)   ,S(230, 239)   ,S(116, 317)   ,S(105, 322)   ,
		S(118, 321)   ,S(171, 314)   ,S(170, 283)   ,S(152, 234)   ,S(159, 208)   ,S(155, 236)   ,S(145, 257)   ,S(88, 280)    ,
		S(127, 250)   ,S(120, 249)   ,S(125, 231)   ,S(130, 213)   ,S(124, 210)   ,S(109, 224)   ,S(77, 248)    ,S(82, 250)    ,
		S(121, 215)   ,S(112, 220)   ,S(121, 209)   ,S(118, 208)   ,S(106, 203)   ,S(90, 216)    ,S(68, 226)    ,S(65, 231)    ,
		S(123, 204)   ,S(134, 197)   ,S(118, 217)   ,S(107, 219)   ,S(95, 215)    ,S(86, 215)    ,S(71, 220)    ,S(64, 222)    ,
		S(126, 203)   ,S(149, 201)   ,S(135, 227)   ,S(98, 240)    ,S(77, 231)    ,S(74, 230)    ,S(66, 231)    ,S(64, 232)    ,
		S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,S(79, 146)    ,
	},
};
const PScore knightTable[2][64] = {
	{
		S(240, 596)   ,S(329, 673)   ,S(311, 720)   ,S(427, 690)   ,S(477, 684)   ,S(334, 722)   ,S(329, 686)   ,S(303, 566)   ,
		S(463, 641)   ,S(463, 666)   ,S(513, 667)   ,S(535, 704)   ,S(529, 706)   ,S(555, 657)   ,S(455, 673)   ,S(482, 643)   ,
		S(449, 653)   ,S(475, 679)   ,S(494, 719)   ,S(502, 723)   ,S(533, 717)   ,S(515, 724)   ,S(470, 699)   ,S(458, 677)   ,
		S(479, 676)   ,S(482, 688)   ,S(494, 721)   ,S(489, 749)   ,S(490, 759)   ,S(498, 740)   ,S(478, 732)   ,S(479, 710)   ,
		S(465, 680)   ,S(473, 692)   ,S(473, 719)   ,S(474, 732)   ,S(481, 742)   ,S(480, 729)   ,S(489, 711)   ,S(470, 706)   ,
		S(443, 632)   ,S(453, 666)   ,S(452, 693)   ,S(462, 721)   ,S(461, 720)   ,S(450, 694)   ,S(452, 683)   ,S(443, 661)   ,
		S(426, 651)   ,S(432, 667)   ,S(438, 664)   ,S(446, 687)   ,S(442, 690)   ,S(435, 664)   ,S(424, 674)   ,S(430, 681)   ,
		S(412, 609)   ,S(437, 628)   ,S(432, 642)   ,S(434, 678)   ,S(431, 681)   ,S(427, 674)   ,S(425, 655)   ,S(390, 640)   ,
	},
	{
		S(269, 554)   ,S(330, 660)   ,S(335, 709)   ,S(453, 676)   ,S(452, 673)   ,S(297, 713)   ,S(313, 677)   ,S(268, 567)   ,
		S(455, 639)   ,S(452, 674)   ,S(515, 670)   ,S(573, 685)   ,S(532, 692)   ,S(538, 660)   ,S(462, 661)   ,S(470, 631)   ,
		S(432, 675)   ,S(493, 685)   ,S(495, 725)   ,S(516, 724)   ,S(533, 711)   ,S(512, 713)   ,S(501, 666)   ,S(458, 653)   ,
		S(466, 692)   ,S(486, 705)   ,S(495, 732)   ,S(504, 742)   ,S(501, 741)   ,S(499, 719)   ,S(484, 704)   ,S(479, 677)   ,
		S(471, 692)   ,S(473, 703)   ,S(482, 722)   ,S(482, 732)   ,S(486, 732)   ,S(479, 720)   ,S(474, 695)   ,S(475, 675)   ,
		S(419, 665)   ,S(445, 678)   ,S(456, 693)   ,S(457, 716)   ,S(459, 716)   ,S(447, 691)   ,S(447, 662)   ,S(429, 634)   ,
		S(416, 690)   ,S(405, 691)   ,S(428, 670)   ,S(438, 683)   ,S(442, 685)   ,S(432, 666)   ,S(415, 673)   ,S(416, 646)   ,
		S(381, 659)   ,S(407, 661)   ,S(417, 672)   ,S(411, 680)   ,S(429, 668)   ,S(433, 635)   ,S(426, 636)   ,S(404, 598)   ,
	},
};
const PScore bishopTable[2][64] = {
	{
		S(417, 763)   ,S(396, 763)   ,S(339, 764)   ,S(332, 774)   ,S(356, 759)   ,S(321, 760)   ,S(425, 744)   ,S(412, 753)   ,
		S(417, 752)   ,S(477, 744)   ,S(474, 739)   ,S(442, 748)   ,S(470, 739)   ,S(465, 744)   ,S(435, 754)   ,S(435, 739)   ,
		S(475, 743)   ,S(480, 748)   ,S(504, 743)   ,S(485, 739)   ,S(497, 741)   ,S(492, 766)   ,S(477, 755)   ,S(467, 761)   ,
		S(464, 743)   ,S(497, 738)   ,S(481, 740)   ,S(503, 760)   ,S(505, 765)   ,S(499, 748)   ,S(503, 750)   ,S(454, 758)   ,
		S(471, 723)   ,S(476, 730)   ,S(470, 756)   ,S(490, 754)   ,S(498, 757)   ,S(471, 749)   ,S(479, 737)   ,S(480, 725)   ,
		S(474, 723)   ,S(488, 732)   ,S(477, 745)   ,S(480, 747)   ,S(476, 746)   ,S(477, 742)   ,S(480, 727)   ,S(484, 732)   ,
		S(486, 714)   ,S(483, 703)   ,S(480, 719)   ,S(459, 736)   ,S(459, 739)   ,S(478, 721)   ,S(491, 718)   ,S(480, 701)   ,
		S(492, 711)   ,S(479, 725)   ,S(459, 729)   ,S(451, 723)   ,S(448, 734)   ,S(455, 741)   ,S(456, 725)   ,S(479, 709)   ,
	},
	{
		S(386, 760)   ,S(351, 756)   ,S(365, 753)   ,S(348, 759)   ,S(336, 763)   ,S(315, 762)   ,S(433, 748)   ,S(394, 770)   ,
		S(393, 746)   ,S(439, 759)   ,S(461, 746)   ,S(440, 740)   ,S(458, 741)   ,S(481, 740)   ,S(477, 750)   ,S(442, 739)   ,
		S(463, 759)   ,S(495, 753)   ,S(496, 751)   ,S(505, 742)   ,S(503, 732)   ,S(508, 746)   ,S(497, 740)   ,S(483, 744)   ,
		S(462, 744)   ,S(503, 743)   ,S(491, 752)   ,S(510, 756)   ,S(521, 753)   ,S(492, 736)   ,S(502, 740)   ,S(479, 743)   ,
		S(478, 729)   ,S(467, 741)   ,S(485, 747)   ,S(500, 754)   ,S(497, 752)   ,S(483, 744)   ,S(484, 725)   ,S(465, 725)   ,
		S(476, 729)   ,S(488, 733)   ,S(489, 745)   ,S(491, 737)   ,S(483, 742)   ,S(483, 734)   ,S(484, 723)   ,S(467, 724)   ,
		S(476, 728)   ,S(500, 710)   ,S(482, 725)   ,S(465, 733)   ,S(463, 732)   ,S(466, 719)   ,S(471, 707)   ,S(480, 695)   ,
		S(488, 714)   ,S(457, 726)   ,S(455, 734)   ,S(451, 724)   ,S(452, 722)   ,S(458, 724)   ,S(472, 723)   ,S(484, 708)   ,
	},
};
const PScore rookTable[2][64] = {
	{
		S(634, 1334)  ,S(628, 1337)  ,S(598, 1349)  ,S(605, 1344)  ,S(598, 1352)  ,S(659, 1345)  ,S(647, 1347)  ,S(651, 1340)  ,
		S(612, 1327)  ,S(598, 1340)  ,S(620, 1334)  ,S(636, 1334)  ,S(621, 1343)  ,S(658, 1320)  ,S(618, 1334)  ,S(624, 1321)  ,
		S(604, 1312)  ,S(656, 1293)  ,S(633, 1308)  ,S(666, 1288)  ,S(680, 1285)  ,S(682, 1302)  ,S(703, 1283)  ,S(633, 1304)  ,
		S(604, 1298)  ,S(626, 1296)  ,S(635, 1296)  ,S(666, 1285)  ,S(651, 1295)  ,S(661, 1295)  ,S(649, 1301)  ,S(629, 1298)  ,
		S(582, 1282)  ,S(582, 1301)  ,S(585, 1296)  ,S(600, 1286)  ,S(591, 1295)  ,S(595, 1301)  ,S(617, 1297)  ,S(595, 1277)  ,
		S(577, 1258)  ,S(588, 1276)  ,S(579, 1271)  ,S(599, 1261)  ,S(594, 1266)  ,S(596, 1273)  ,S(624, 1263)  ,S(594, 1240)  ,
		S(560, 1254)  ,S(591, 1253)  ,S(589, 1259)  ,S(600, 1251)  ,S(597, 1253)  ,S(610, 1246)  ,S(619, 1236)  ,S(544, 1256)  ,
		S(598, 1253)  ,S(599, 1259)  ,S(602, 1260)  ,S(610, 1252)  ,S(609, 1253)  ,S(612, 1271)  ,S(608, 1262)  ,S(597, 1233)  ,
	},
	{
		S(648, 1330)  ,S(606, 1354)  ,S(629, 1350)  ,S(619, 1339)  ,S(626, 1334)  ,S(633, 1325)  ,S(663, 1315)  ,S(666, 1315)  ,
		S(588, 1336)  ,S(611, 1337)  ,S(645, 1329)  ,S(635, 1329)  ,S(635, 1326)  ,S(648, 1309)  ,S(614, 1322)  ,S(628, 1314)  ,
		S(599, 1320)  ,S(661, 1299)  ,S(648, 1313)  ,S(672, 1286)  ,S(687, 1274)  ,S(656, 1292)  ,S(687, 1274)  ,S(631, 1298)  ,
		S(590, 1307)  ,S(635, 1301)  ,S(652, 1298)  ,S(656, 1287)  ,S(656, 1285)  ,S(643, 1287)  ,S(645, 1282)  ,S(629, 1288)  ,
		S(562, 1274)  ,S(596, 1291)  ,S(588, 1301)  ,S(590, 1291)  ,S(592, 1286)  ,S(587, 1293)  ,S(589, 1293)  ,S(587, 1276)  ,
		S(550, 1247)  ,S(595, 1263)  ,S(596, 1265)  ,S(588, 1259)  ,S(588, 1262)  ,S(586, 1265)  ,S(605, 1266)  ,S(583, 1247)  ,
		S(457, 1276)  ,S(574, 1243)  ,S(591, 1254)  ,S(591, 1253)  ,S(594, 1247)  ,S(597, 1244)  ,S(599, 1239)  ,S(555, 1240)  ,
		S(552, 1258)  ,S(577, 1269)  ,S(607, 1260)  ,S(608, 1253)  ,S(606, 1245)  ,S(604, 1250)  ,S(610, 1245)  ,S(599, 1238)  ,
	},
};
const PScore queenTable[2][64] = {
	{
		S(1219, 1906) ,S(1250, 1899) ,S(1230, 1939) ,S(1233, 1946) ,S(1219, 1978) ,S(1251, 1979) ,S(1255, 1942) ,S(1244, 1917) ,
		S(1248, 1881) ,S(1193, 1929) ,S(1244, 1903) ,S(1182, 1973) ,S(1187, 2013) ,S(1267, 1984) ,S(1185, 1983) ,S(1262, 1923) ,
		S(1253, 1878) ,S(1257, 1874) ,S(1244, 1900) ,S(1254, 1915) ,S(1261, 1953) ,S(1266, 1970) ,S(1262, 1969) ,S(1243, 1981) ,
		S(1266, 1862) ,S(1265, 1901) ,S(1255, 1891) ,S(1238, 1964) ,S(1239, 1986) ,S(1275, 1980) ,S(1285, 1969) ,S(1282, 1938) ,
		S(1270, 1836) ,S(1268, 1884) ,S(1256, 1900) ,S(1251, 1952) ,S(1252, 1947) ,S(1268, 1932) ,S(1279, 1908) ,S(1285, 1890) ,
		S(1275, 1814) ,S(1282, 1848) ,S(1272, 1882) ,S(1269, 1875) ,S(1269, 1865) ,S(1275, 1890) ,S(1289, 1853) ,S(1286, 1824) ,
		S(1279, 1804) ,S(1282, 1811) ,S(1290, 1800) ,S(1285, 1835) ,S(1285, 1822) ,S(1304, 1763) ,S(1292, 1766) ,S(1259, 1814) ,
		S(1280, 1797) ,S(1283, 1800) ,S(1289, 1798) ,S(1296, 1828) ,S(1296, 1786) ,S(1270, 1784) ,S(1269, 1754) ,S(1264, 1782) ,
	},
	{
		S(1260, 1852) ,S(1253, 1889) ,S(1255, 1915) ,S(1240, 1955) ,S(1226, 1953) ,S(1250, 1915) ,S(1247, 1890) ,S(1248, 1875) ,
		S(1242, 1898) ,S(1181, 1948) ,S(1251, 1946) ,S(1181, 2001) ,S(1167, 2016) ,S(1248, 1906) ,S(1198, 1933) ,S(1268, 1865) ,
		S(1249, 1922) ,S(1253, 1922) ,S(1241, 1952) ,S(1264, 1943) ,S(1267, 1916) ,S(1252, 1916) ,S(1283, 1861) ,S(1283, 1874) ,
		S(1267, 1901) ,S(1279, 1943) ,S(1269, 1940) ,S(1257, 1971) ,S(1255, 1952) ,S(1269, 1889) ,S(1284, 1895) ,S(1290, 1871) ,
		S(1274, 1852) ,S(1275, 1906) ,S(1267, 1915) ,S(1262, 1945) ,S(1266, 1923) ,S(1268, 1891) ,S(1281, 1865) ,S(1277, 1836) ,
		S(1252, 1843) ,S(1280, 1845) ,S(1277, 1882) ,S(1277, 1858) ,S(1277, 1859) ,S(1281, 1859) ,S(1288, 1834) ,S(1283, 1798) ,
		S(1235, 1809) ,S(1270, 1776) ,S(1302, 1760) ,S(1294, 1808) ,S(1289, 1822) ,S(1297, 1778) ,S(1296, 1786) ,S(1292, 1770) ,
		S(1239, 1785) ,S(1267, 1750) ,S(1271, 1753) ,S(1290, 1769) ,S(1296, 1787) ,S(1298, 1764) ,S(1298, 1776) ,S(1291, 1760) ,
	},
};
const PScore kingTable[2][64] = {
	{
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(109, -44)   ,S(80, -34)    ,S(67, -30)    ,S(-22, -193)  ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(159, 14)    ,S(166, 33)    ,S(80, 66)     ,S(-3, -28)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(176, 44)    ,S(241, 50)    ,S(181, 57)    ,S(43, 11)     ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(127, 65)    ,S(150, 58)    ,S(121, 38)    ,S(-50, 16)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(81, 65)     ,S(87, 43)     ,S(82, 15)     ,S(-59, -13)   ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(30, 54)     ,S(33, 30)     ,S(24, 3)      ,S(-42, -15)   ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-62, 40)    ,S(-49, 37)    ,S(-1, 0)      ,S(5, -41)     ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-66, -27)   ,S(-92, 10)    ,S(-2, -36)    ,S(7, -124)    ,
	},
	{
		S(-13, -204)  ,S(58, -79)    ,S(98, -66)    ,S(117, -37)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-43, -42)   ,S(94, 38)     ,S(154, 17)    ,S(203, -13)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(7, 14)      ,S(179, 44)    ,S(208, 38)    ,S(181, 31)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-42, 14)    ,S(133, 22)    ,S(153, 45)    ,S(125, 51)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-54, -27)   ,S(72, 5)      ,S(119, 27)    ,S(75, 52)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-72, -16)   ,S(12, -7)     ,S(40, 12)     ,S(21, 37)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-11, -34)   ,S(-14, -14)   ,S(-19, 11)    ,S(-69, 24)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-25, -108)  ,S(-13, -53)   ,S(-50, -11)   ,S(-93, -25)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
};

constexpr PScore materialValues[5] = {S(79, 146), S(381, 555), S(378, 572), S(389, 847), S(1053, 1601), };
constexpr PScore knightMob[9] = {S(-25, -135), S(-6, -56), S(4, -9), S(11, 17), S(17, 29), S(21, 42), S(29, 41), S(39, 35), S(51, 10), };
constexpr PScore bishopMob[14] = {S(-48, -186), S(-18, -110), S(-1, -56), S(6, -27), S(17, -7), S(22, 12), S(25, 24), S(23, 32), S(23, 43), S(27, 43), S(36, 37), S(58, 22), S(63, 29), S(87, -16), };
constexpr PScore rookMob[15] = {S(-18, -157), S(-23, -108), S(-14, -74), S(-13, -57), S(-12, -40), S(-14, -21), S(-12, -11), S(-6, -12), S(-2, -6), S(7, -2), S(6, 3), S(12, 8), S(15, 8), S(32, -12), S(96, -47), };
constexpr PScore queenMob[28] = {S(-104, -609), S(-71, -543), S(-32, -439), S(-15, -340), S(-13, -242), S(-10, -182), S(-7, -147), S(-3, -128), S(-2, -109), S(4, -96), S(8, -89), S(13, -85), S(16, -82), S(21, -79), S(23, -80), S(24, -82), S(23, -84), S(19, -82), S(23, -88), S(25, -99), S(40, -125), S(47, -144), S(47, -158), S(58, -184), S(36, -188), S(46, -218), S(32, -201), S(10, -164), };

constexpr Score gamephaseInc[12] = { 0, 1, 1, 2, 4, 0, 0, 1, 1, 2, 4, 0 };

//constexpr Score KSAMG = -2;
constexpr double KSCALEMG = 929.3899536132812;
constexpr double KSBMG = 1; //1.4999407529830933;
constexpr double KSCMG = -3.0785765647888184;
// constexpr Score KSAEG = -71;
constexpr double KSCALEEG = 764.1466674804688;
constexpr double KSBEG = 1; //1.1963030099868774;
constexpr double KSCEG = 2.285745143890381;

#define PAWNHASHSIZE 262144ULL

struct PawnEvalHashEntry {
    U64 hash;
    PScore score;
    BitBoard passers; // This can be shrinked to add more stuff and keep the alignement
};

extern PawnEvalHashEntry pawnEvalHash[PAWNHASHSIZE];

extern PScore PSQTs[2][12][64];
/**
* @brief The initTables function initializes the material - positional tables
* @note This function is called once at the beginning of the program
*/
void initTables();

/**
 * @brief The pestoEval function evaluates the material and positional scores
 * @param pos The position to evaluate
 * @return The material and positional scores
 */
Score pestoEval(Position* pos);

/** 
 * @brief The initTropism function initializes the tropism tables
 * @note This is called at the start of the program 
 */
void initTropism();

/**
 * @brief The convertToFeatures function converts a set of positions to a set of features
 * @param filename The filename of the epd file
 * @param output The output file to write the features to
 */
void convertToFeatures(std::string filename, std::string output);