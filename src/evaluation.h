#pragma once

#include "BBmacros.h"
#include "Position.h"

const PScore pawnTable[2][64] = {
	{
		S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,
		S(201, 263)   ,S(156, 262)   ,S(196, 214)   ,S(199, 174)   ,S(173, 183)   ,S(114, 226)   ,S(-95, 297)   ,S(-65, 307)   ,
		S(90, 288)    ,S(118, 268)   ,S(142, 227)   ,S(135, 186)   ,S(148, 198)   ,S(202, 232)   ,S(143, 268)   ,S(104, 274)   ,
		S(88, 243)    ,S(90, 226)    ,S(98, 208)    ,S(114, 179)   ,S(124, 195)   ,S(132, 209)   ,S(95, 233)    ,S(91, 228)    ,
		S(82, 216)    ,S(78, 209)    ,S(93, 192)    ,S(103, 184)   ,S(107, 191)   ,S(109, 201)   ,S(94, 205)    ,S(92, 202)    ,
		S(84, 206)    ,S(82, 201)    ,S(89, 198)    ,S(100, 195)   ,S(109, 211)   ,S(101, 214)   ,S(115, 192)   ,S(104, 187)   ,
		S(81, 216)    ,S(78, 209)    ,S(77, 208)    ,S(87, 214)    ,S(85, 234)    ,S(122, 227)   ,S(134, 202)   ,S(106, 178)   ,
		S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,
	},
	{
		S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,
		S(120, 320)   ,S(83, 327)    ,S(160, 299)   ,S(176, 228)   ,S(175, 211)   ,S(200, 192)   ,S(84, 256)    ,S(74, 258)    ,
		S(108, 309)   ,S(161, 304)   ,S(162, 275)   ,S(146, 230)   ,S(156, 204)   ,S(155, 229)   ,S(144, 247)   ,S(84, 267)    ,
		S(123, 240)   ,S(114, 240)   ,S(122, 224)   ,S(127, 206)   ,S(124, 202)   ,S(107, 213)   ,S(74, 236)    ,S(79, 238)    ,
		S(118, 209)   ,S(107, 214)   ,S(117, 203)   ,S(115, 201)   ,S(103, 194)   ,S(88, 207)    ,S(65, 215)    ,S(62, 219)    ,
		S(120, 197)   ,S(131, 192)   ,S(114, 210)   ,S(104, 211)   ,S(93, 207)    ,S(83, 206)    ,S(69, 211)    ,S(61, 211)    ,
		S(124, 197)   ,S(146, 196)   ,S(132, 221)   ,S(95, 231)    ,S(74, 222)    ,S(71, 221)    ,S(62, 222)    ,S(60, 222)    ,
		S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,S(96, 194)    ,
	},
};
const PScore knightTable[2][64] = {
	{
		S(234, 573)   ,S(328, 643)   ,S(310, 686)   ,S(422, 665)   ,S(477, 661)   ,S(331, 688)   ,S(324, 655)   ,S(301, 545)   ,
		S(461, 620)   ,S(462, 644)   ,S(511, 647)   ,S(534, 684)   ,S(527, 685)   ,S(556, 640)   ,S(454, 649)   ,S(481, 624)   ,
		S(447, 630)   ,S(475, 656)   ,S(494, 694)   ,S(501, 697)   ,S(532, 693)   ,S(513, 701)   ,S(467, 674)   ,S(455, 654)   ,
		S(478, 654)   ,S(482, 665)   ,S(492, 694)   ,S(487, 720)   ,S(488, 730)   ,S(496, 713)   ,S(474, 704)   ,S(477, 684)   ,
		S(464, 657)   ,S(471, 668)   ,S(470, 693)   ,S(473, 704)   ,S(478, 713)   ,S(477, 702)   ,S(488, 684)   ,S(469, 681)   ,
		S(441, 609)   ,S(451, 644)   ,S(450, 668)   ,S(460, 693)   ,S(460, 692)   ,S(449, 667)   ,S(451, 657)   ,S(442, 636)   ,
		S(423, 628)   ,S(430, 644)   ,S(438, 639)   ,S(445, 661)   ,S(441, 662)   ,S(436, 636)   ,S(423, 646)   ,S(428, 651)   ,
		S(411, 588)   ,S(436, 604)   ,S(432, 618)   ,S(433, 652)   ,S(430, 654)   ,S(426, 645)   ,S(425, 627)   ,S(389, 615)   ,
	},
	{
		S(263, 536)   ,S(333, 633)   ,S(341, 673)   ,S(446, 655)   ,S(451, 650)   ,S(304, 677)   ,S(316, 645)   ,S(265, 546)   ,
		S(454, 619)   ,S(449, 651)   ,S(513, 652)   ,S(573, 669)   ,S(531, 673)   ,S(538, 643)   ,S(458, 640)   ,S(469, 614)   ,
		S(429, 650)   ,S(493, 662)   ,S(492, 700)   ,S(515, 699)   ,S(532, 689)   ,S(511, 688)   ,S(500, 645)   ,S(455, 633)   ,
		S(466, 666)   ,S(485, 678)   ,S(493, 706)   ,S(502, 715)   ,S(501, 716)   ,S(497, 694)   ,S(482, 679)   ,S(477, 653)   ,
		S(470, 667)   ,S(473, 677)   ,S(481, 695)   ,S(482, 705)   ,S(486, 705)   ,S(477, 694)   ,S(473, 671)   ,S(474, 653)   ,
		S(420, 641)   ,S(444, 653)   ,S(455, 667)   ,S(455, 689)   ,S(458, 689)   ,S(446, 665)   ,S(445, 638)   ,S(428, 612)   ,
		S(415, 661)   ,S(404, 662)   ,S(428, 643)   ,S(437, 656)   ,S(442, 660)   ,S(431, 641)   ,S(414, 648)   ,S(415, 623)   ,
		S(380, 632)   ,S(407, 632)   ,S(416, 645)   ,S(410, 654)   ,S(429, 644)   ,S(433, 612)   ,S(425, 612)   ,S(402, 579)   ,
	},
};
const PScore bishopTable[2][64] = {
	{
		S(410, 734)   ,S(385, 733)   ,S(328, 732)   ,S(326, 739)   ,S(350, 727)   ,S(315, 726)   ,S(416, 715)   ,S(405, 723)   ,
		S(406, 724)   ,S(469, 718)   ,S(467, 714)   ,S(434, 721)   ,S(464, 713)   ,S(457, 719)   ,S(425, 727)   ,S(429, 712)   ,
		S(469, 716)   ,S(474, 721)   ,S(497, 717)   ,S(478, 713)   ,S(491, 716)   ,S(484, 739)   ,S(470, 728)   ,S(460, 734)   ,
		S(456, 715)   ,S(492, 713)   ,S(475, 715)   ,S(498, 734)   ,S(500, 738)   ,S(493, 723)   ,S(498, 725)   ,S(448, 729)   ,
		S(465, 699)   ,S(472, 706)   ,S(466, 729)   ,S(485, 728)   ,S(493, 731)   ,S(466, 724)   ,S(474, 711)   ,S(474, 700)   ,
		S(467, 698)   ,S(482, 707)   ,S(471, 719)   ,S(475, 721)   ,S(471, 720)   ,S(472, 717)   ,S(477, 704)   ,S(479, 708)   ,
		S(481, 691)   ,S(478, 680)   ,S(474, 693)   ,S(454, 710)   ,S(454, 712)   ,S(471, 696)   ,S(486, 696)   ,S(476, 676)   ,
		S(486, 689)   ,S(473, 701)   ,S(453, 702)   ,S(447, 698)   ,S(443, 707)   ,S(449, 713)   ,S(450, 700)   ,S(473, 685)   ,
	},
	{
		S(379, 728)   ,S(340, 724)   ,S(353, 721)   ,S(341, 725)   ,S(331, 729)   ,S(305, 729)   ,S(421, 721)   ,S(386, 738)   ,
		S(384, 717)   ,S(429, 730)   ,S(453, 719)   ,S(432, 713)   ,S(451, 714)   ,S(474, 715)   ,S(467, 724)   ,S(434, 712)   ,
		S(458, 730)   ,S(490, 726)   ,S(489, 726)   ,S(497, 718)   ,S(496, 710)   ,S(499, 722)   ,S(491, 715)   ,S(478, 719)   ,
		S(455, 717)   ,S(498, 719)   ,S(487, 725)   ,S(506, 732)   ,S(517, 730)   ,S(486, 712)   ,S(496, 716)   ,S(473, 716)   ,
		S(474, 703)   ,S(461, 715)   ,S(479, 722)   ,S(495, 728)   ,S(493, 727)   ,S(477, 718)   ,S(478, 700)   ,S(459, 701)   ,
		S(472, 705)   ,S(482, 709)   ,S(484, 719)   ,S(486, 712)   ,S(478, 716)   ,S(478, 709)   ,S(477, 700)   ,S(460, 698)   ,
		S(472, 702)   ,S(496, 688)   ,S(478, 701)   ,S(462, 706)   ,S(458, 705)   ,S(461, 695)   ,S(465, 684)   ,S(474, 674)   ,
		S(484, 691)   ,S(453, 699)   ,S(450, 708)   ,S(446, 698)   ,S(447, 698)   ,S(453, 699)   ,S(467, 699)   ,S(479, 685)   ,
	},
};
const PScore rookTable[2][64] = {
	{
		S(629, 1263)  ,S(625, 1265)  ,S(594, 1274)  ,S(596, 1272)  ,S(588, 1279)  ,S(640, 1279)  ,S(634, 1278)  ,S(644, 1269)  ,
		S(606, 1256)  ,S(591, 1267)  ,S(616, 1263)  ,S(633, 1264)  ,S(614, 1271)  ,S(651, 1252)  ,S(608, 1264)  ,S(615, 1253)  ,
		S(597, 1243)  ,S(652, 1229)  ,S(628, 1242)  ,S(662, 1224)  ,S(676, 1222)  ,S(676, 1240)  ,S(699, 1223)  ,S(626, 1238)  ,
		S(596, 1231)  ,S(620, 1229)  ,S(630, 1231)  ,S(660, 1221)  ,S(646, 1231)  ,S(654, 1231)  ,S(641, 1235)  ,S(622, 1231)  ,
		S(574, 1215)  ,S(574, 1231)  ,S(578, 1228)  ,S(593, 1220)  ,S(583, 1228)  ,S(586, 1234)  ,S(609, 1229)  ,S(587, 1212)  ,
		S(571, 1193)  ,S(581, 1211)  ,S(572, 1205)  ,S(592, 1197)  ,S(587, 1200)  ,S(588, 1206)  ,S(619, 1199)  ,S(588, 1176)  ,
		S(553, 1188)  ,S(585, 1189)  ,S(582, 1194)  ,S(592, 1188)  ,S(590, 1189)  ,S(605, 1183)  ,S(614, 1174)  ,S(538, 1188)  ,
		S(591, 1189)  ,S(591, 1195)  ,S(595, 1197)  ,S(603, 1189)  ,S(602, 1191)  ,S(605, 1208)  ,S(601, 1198)  ,S(592, 1170)  ,
	},
	{
		S(645, 1260)  ,S(600, 1280)  ,S(622, 1277)  ,S(611, 1269)  ,S(622, 1263)  ,S(637, 1253)  ,S(667, 1246)  ,S(666, 1247)  ,
		S(580, 1263)  ,S(607, 1267)  ,S(639, 1260)  ,S(632, 1260)  ,S(632, 1256)  ,S(648, 1241)  ,S(612, 1251)  ,S(625, 1245)  ,
		S(595, 1249)  ,S(655, 1234)  ,S(647, 1247)  ,S(669, 1223)  ,S(683, 1215)  ,S(653, 1226)  ,S(686, 1212)  ,S(626, 1231)  ,
		S(585, 1236)  ,S(630, 1234)  ,S(647, 1232)  ,S(651, 1225)  ,S(651, 1221)  ,S(639, 1222)  ,S(639, 1218)  ,S(623, 1223)  ,
		S(556, 1205)  ,S(590, 1223)  ,S(581, 1233)  ,S(583, 1224)  ,S(586, 1219)  ,S(581, 1226)  ,S(582, 1226)  ,S(581, 1210)  ,
		S(546, 1181)  ,S(591, 1196)  ,S(592, 1197)  ,S(584, 1195)  ,S(583, 1196)  ,S(580, 1199)  ,S(598, 1201)  ,S(577, 1184)  ,
		S(454, 1200)  ,S(569, 1178)  ,S(586, 1189)  ,S(584, 1189)  ,S(589, 1184)  ,S(591, 1181)  ,S(593, 1177)  ,S(549, 1175)  ,
		S(546, 1192)  ,S(571, 1205)  ,S(600, 1197)  ,S(602, 1191)  ,S(601, 1185)  ,S(598, 1187)  ,S(605, 1183)  ,S(593, 1175)  ,
	},
};
const PScore queenTable[2][64] = {
	{
		S(1271, 1444) ,S(1304, 1439) ,S(1278, 1477) ,S(1278, 1487) ,S(1267, 1513) ,S(1305, 1511) ,S(1314, 1473) ,S(1299, 1453) ,
		S(1297, 1426) ,S(1241, 1470) ,S(1294, 1445) ,S(1230, 1510) ,S(1235, 1544) ,S(1315, 1520) ,S(1232, 1516) ,S(1313, 1465) ,
		S(1301, 1428) ,S(1306, 1425) ,S(1292, 1445) ,S(1303, 1458) ,S(1311, 1492) ,S(1316, 1507) ,S(1311, 1509) ,S(1292, 1524) ,
		S(1315, 1412) ,S(1314, 1448) ,S(1305, 1435) ,S(1290, 1496) ,S(1290, 1518) ,S(1324, 1520) ,S(1334, 1513) ,S(1331, 1486) ,
		S(1319, 1389) ,S(1317, 1433) ,S(1304, 1448) ,S(1298, 1495) ,S(1302, 1490) ,S(1315, 1482) ,S(1329, 1457) ,S(1334, 1440) ,
		S(1326, 1368) ,S(1331, 1403) ,S(1321, 1433) ,S(1318, 1426) ,S(1321, 1416) ,S(1324, 1441) ,S(1340, 1403) ,S(1338, 1378) ,
		S(1330, 1360) ,S(1333, 1366) ,S(1341, 1354) ,S(1335, 1387) ,S(1337, 1374) ,S(1356, 1319) ,S(1346, 1320) ,S(1311, 1365) ,
		S(1331, 1354) ,S(1335, 1352) ,S(1341, 1352) ,S(1347, 1379) ,S(1349, 1337) ,S(1322, 1338) ,S(1321, 1312) ,S(1315, 1337) ,
	},
	{
		S(1318, 1396) ,S(1312, 1430) ,S(1310, 1454) ,S(1291, 1493) ,S(1285, 1481) ,S(1314, 1443) ,S(1307, 1425) ,S(1307, 1412) ,
		S(1297, 1438) ,S(1231, 1485) ,S(1303, 1485) ,S(1230, 1535) ,S(1217, 1545) ,S(1299, 1449) ,S(1250, 1471) ,S(1321, 1412) ,
		S(1301, 1466) ,S(1307, 1462) ,S(1294, 1487) ,S(1319, 1479) ,S(1319, 1459) ,S(1307, 1456) ,S(1337, 1410) ,S(1336, 1424) ,
		S(1319, 1450) ,S(1333, 1486) ,S(1322, 1481) ,S(1314, 1503) ,S(1310, 1486) ,S(1324, 1432) ,S(1339, 1441) ,S(1344, 1417) ,
		S(1327, 1405) ,S(1328, 1455) ,S(1318, 1466) ,S(1315, 1489) ,S(1320, 1467) ,S(1318, 1442) ,S(1334, 1416) ,S(1331, 1391) ,
		S(1307, 1395) ,S(1334, 1397) ,S(1332, 1430) ,S(1330, 1408) ,S(1331, 1410) ,S(1335, 1412) ,S(1342, 1389) ,S(1337, 1357) ,
		S(1289, 1362) ,S(1326, 1330) ,S(1358, 1315) ,S(1349, 1363) ,S(1344, 1374) ,S(1353, 1332) ,S(1351, 1342) ,S(1346, 1331) ,
		S(1294, 1338) ,S(1323, 1303) ,S(1329, 1307) ,S(1347, 1320) ,S(1352, 1341) ,S(1356, 1319) ,S(1355, 1333) ,S(1347, 1318) ,
	},
};
const PScore kingTable[2][64] = {
	{
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(158, -37)   ,S(148, -34)   ,S(103, -30)   ,S(86, -189)   ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(235, 15)    ,S(247, 31)    ,S(115, 61)    ,S(6, -29)     ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(293, 39)    ,S(363, 49)    ,S(231, 59)    ,S(46, 11)     ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(199, 59)    ,S(202, 56)    ,S(142, 40)    ,S(-73, 13)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(103, 62)    ,S(90, 44)     ,S(78, 17)     ,S(-77, -16)   ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(26, 50)     ,S(23, 30)     ,S(12, 3)      ,S(-54, -16)   ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-75, 34)    ,S(-61, 32)    ,S(-13, -1)    ,S(-8, -39)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-77, -31)   ,S(-105, 5)    ,S(-14, -35)   ,S(-3, -118)   ,
	},
	{
		S(104, -204)  ,S(137, -81)   ,S(176, -65)   ,S(169, -34)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-31, -46)   ,S(144, 32)    ,S(240, 13)    ,S(303, -13)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(13, 9)      ,S(237, 43)    ,S(318, 35)    ,S(285, 26)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-57, 9)     ,S(167, 22)    ,S(213, 42)    ,S(189, 45)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-68, -30)   ,S(71, 6)      ,S(130, 27)    ,S(83, 50)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-87, -20)   ,S(-2, -7)     ,S(24, 14)     ,S(6, 35)      ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-29, -33)   ,S(-32, -16)   ,S(-37, 8)     ,S(-87, 18)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-40, -105)  ,S(-28, -50)   ,S(-68, -14)   ,S(-112, -30)  ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
};

constexpr PScore materialValues[5] = {S(96, 194), S(420, 603), S(430, 645), S(568, 1133), S(1303, 1370), };
constexpr PScore knightMob[9] = {S(-22, -129), S(-6, -53), S(5, -6), S(11, 19), S(16, 29), S(21, 43), S(29, 43), S(40, 38), S(52, 17), };
constexpr PScore bishopMob[14] = {S(-42, -182), S(-14, -105), S(2, -51), S(10, -23), S(20, -3), S(23, 15), S(27, 26), S(25, 34), S(26, 44), S(28, 44), S(37, 38), S(63, 26), S(72, 33), S(106, -6), };
constexpr PScore rookMob[15] = {S(-17, -145), S(-24, -93), S(-17, -58), S(-15, -41), S(-15, -24), S(-17, -6), S(-14, 4), S(-9, 5), S(-6, 9), S(3, 12), S(2, 18), S(8, 21), S(11, 22), S(29, 4), S(96, -21), };
constexpr PScore queenMob[28] = {S(-117, -457), S(-74, -485), S(-37, -389), S(-22, -294), S(-20, -202), S(-17, -143), S(-15, -107), S(-13, -88), S(-11, -68), S(-6, -55), S(-3, -49), S(1, -45), S(6, -41), S(9, -39), S(12, -38), S(13, -39), S(12, -40), S(6, -38), S(9, -43), S(11, -51), S(27, -73), S(33, -87), S(33, -100), S(47, -119), S(25, -126), S(34, -144), S(-1, -114), S(-9, -89), };

constexpr S32 gamePhaseInc[12] = { -145, -453, -518, -1048, -2203, 0, -145, -453, -518, -1048, -2203, 0 };
constexpr S32 gamePhaseBias = 1336;
constexpr S32 gamePhaseOnes = gamePhaseInc[0] + gamePhaseInc[1] + gamePhaseInc[2] + gamePhaseInc[3] + gamePhaseInc[4] + gamePhaseInc[5] + gamePhaseBias;

//constexpr Score KSAMG = -2;
constexpr double KSCALEMG = 931.8497924804688;
constexpr double KSBMG = -1.7074624300003052;
constexpr double KSCMG = -3.201645851135254;
// constexpr Score KSAEG = -71;
constexpr double KSCALEEG = 1055.2093505859375;
constexpr double KSBEG = 2.024080753326416;
constexpr double KSCEG = 2.4812381267547607;

#define PAWNHASHSIZE 262144ULL

struct PawnEvalHashEntry {
    U64 hash;
    PScore score;
    BitBoard passers; // This can be shrinked to add more stuff and keep the alignement
};

extern PawnEvalHashEntry pawnEvalHash[PAWNHASHSIZE];

extern PScore PSQTs[2][12][64];
/**
* @brief The initTables function initializes the material - positional tables
* @note This function is called once at the beginning of the program
*/
void initTables();

/**
 * @brief The pestoEval function evaluates the material and positional scores
 * @param pos The position to evaluate
 * @return The material and positional scores
 */
Score pestoEval(Position* pos);

/** 
 * @brief The initTropism function initializes the tropism tables
 * @note This is called at the start of the program 
 */
void initTropism();

/**
 * @brief The convertToFeatures function converts a set of positions to a set of features
 * @param filename The filename of the epd file
 * @param output The output file to write the features to
 */
void convertToFeatures(std::string filename, std::string output);