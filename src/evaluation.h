#pragma once

#include "BBmacros.h"
#include "Position.h"

const PScore pawnTable[2][64] = {
	{
		S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,
		S(195, 270)   ,S(152, 271)   ,S(192, 217)   ,S(199, 173)   ,S(179, 181)   ,S(125, 229)   ,S(-75, 320)   ,S(-44, 330)   ,
		S(95, 297)    ,S(121, 276)   ,S(143, 231)   ,S(136, 188)   ,S(149, 198)   ,S(204, 234)   ,S(148, 272)   ,S(107, 281)   ,
		S(91, 249)    ,S(93, 233)    ,S(100, 214)   ,S(116, 184)   ,S(127, 199)   ,S(135, 214)   ,S(98, 239)    ,S(93, 237)    ,
		S(85, 224)    ,S(80, 215)    ,S(95, 197)    ,S(104, 189)   ,S(109, 195)   ,S(113, 205)   ,S(97, 208)    ,S(95, 207)    ,
		S(86, 211)    ,S(85, 206)    ,S(91, 204)    ,S(102, 202)   ,S(112, 217)   ,S(104, 219)   ,S(118, 195)   ,S(107, 192)   ,
		S(84, 221)    ,S(82, 213)    ,S(80, 213)    ,S(89, 218)    ,S(88, 240)    ,S(125, 231)   ,S(137, 204)   ,S(107, 182)   ,
		S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,
	},
	{
		S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,
		S(134, 329)   ,S(104, 338)   ,S(181, 300)   ,S(188, 227)   ,S(181, 212)   ,S(197, 191)   ,S(87, 266)    ,S(77, 271)    ,
		S(119, 316)   ,S(171, 307)   ,S(170, 279)   ,S(153, 231)   ,S(158, 204)   ,S(155, 232)   ,S(146, 253)   ,S(89, 275)    ,
		S(126, 245)   ,S(119, 245)   ,S(125, 228)   ,S(129, 210)   ,S(124, 206)   ,S(110, 220)   ,S(76, 243)    ,S(81, 246)    ,
		S(121, 212)   ,S(110, 216)   ,S(120, 205)   ,S(117, 205)   ,S(106, 198)   ,S(91, 212)    ,S(68, 221)    ,S(65, 226)    ,
		S(123, 201)   ,S(135, 194)   ,S(119, 214)   ,S(107, 215)   ,S(94, 211)    ,S(86, 212)    ,S(72, 217)    ,S(64, 220)    ,
		S(126, 199)   ,S(148, 196)   ,S(135, 223)   ,S(99, 236)    ,S(78, 229)    ,S(73, 226)    ,S(66, 228)    ,S(65, 229)    ,
		S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,S(98, 196)    ,
	},
};
const PScore knightTable[2][64] = {
	{
		S(241, 581)   ,S(330, 656)   ,S(311, 704)   ,S(424, 674)   ,S(474, 668)   ,S(336, 704)   ,S(334, 669)   ,S(303, 553)   ,
		S(460, 626)   ,S(460, 650)   ,S(509, 651)   ,S(532, 689)   ,S(525, 690)   ,S(551, 643)   ,S(453, 657)   ,S(479, 628)   ,
		S(446, 637)   ,S(473, 663)   ,S(492, 703)   ,S(500, 706)   ,S(530, 701)   ,S(513, 708)   ,S(467, 684)   ,S(456, 662)   ,
		S(475, 660)   ,S(480, 672)   ,S(491, 703)   ,S(486, 731)   ,S(489, 743)   ,S(495, 724)   ,S(476, 716)   ,S(476, 693)   ,
		S(462, 664)   ,S(470, 674)   ,S(470, 703)   ,S(472, 716)   ,S(479, 726)   ,S(476, 712)   ,S(488, 695)   ,S(467, 691)   ,
		S(440, 617)   ,S(451, 651)   ,S(449, 677)   ,S(460, 705)   ,S(459, 703)   ,S(447, 677)   ,S(450, 668)   ,S(440, 646)   ,
		S(422, 636)   ,S(429, 652)   ,S(434, 646)   ,S(443, 672)   ,S(440, 674)   ,S(433, 649)   ,S(421, 659)   ,S(427, 665)   ,
		S(410, 595)   ,S(434, 614)   ,S(429, 627)   ,S(430, 661)   ,S(428, 665)   ,S(424, 659)   ,S(423, 640)   ,S(388, 625)   ,
	},
	{
		S(271, 540)   ,S(336, 642)   ,S(342, 689)   ,S(450, 661)   ,S(447, 658)   ,S(303, 694)   ,S(318, 659)   ,S(272, 552)   ,
		S(452, 624)   ,S(448, 659)   ,S(511, 655)   ,S(568, 669)   ,S(528, 677)   ,S(533, 646)   ,S(458, 645)   ,S(466, 617)   ,
		S(429, 659)   ,S(489, 669)   ,S(492, 709)   ,S(512, 706)   ,S(529, 695)   ,S(508, 696)   ,S(497, 650)   ,S(454, 638)   ,
		S(463, 675)   ,S(484, 688)   ,S(492, 715)   ,S(501, 725)   ,S(499, 724)   ,S(496, 703)   ,S(481, 688)   ,S(476, 660)   ,
		S(468, 676)   ,S(470, 688)   ,S(479, 706)   ,S(479, 714)   ,S(484, 716)   ,S(475, 703)   ,S(471, 679)   ,S(472, 659)   ,
		S(417, 650)   ,S(443, 662)   ,S(453, 677)   ,S(454, 700)   ,S(457, 701)   ,S(445, 674)   ,S(443, 646)   ,S(426, 618)   ,
		S(414, 674)   ,S(402, 675)   ,S(426, 655)   ,S(434, 668)   ,S(440, 669)   ,S(429, 650)   ,S(413, 657)   ,S(414, 631)   ,
		S(378, 644)   ,S(404, 645)   ,S(414, 656)   ,S(408, 666)   ,S(427, 653)   ,S(429, 621)   ,S(423, 620)   ,S(401, 584)   ,
	},
};
const PScore bishopTable[2][64] = {
	{
		S(414, 746)   ,S(393, 745)   ,S(338, 747)   ,S(331, 756)   ,S(355, 742)   ,S(321, 742)   ,S(424, 726)   ,S(410, 735)   ,
		S(414, 734)   ,S(473, 727)   ,S(471, 723)   ,S(438, 731)   ,S(466, 722)   ,S(461, 728)   ,S(431, 737)   ,S(433, 722)   ,
		S(471, 725)   ,S(476, 731)   ,S(501, 726)   ,S(482, 723)   ,S(494, 725)   ,S(488, 749)   ,S(474, 738)   ,S(464, 744)   ,
		S(459, 725)   ,S(495, 721)   ,S(478, 724)   ,S(501, 744)   ,S(502, 749)   ,S(496, 731)   ,S(501, 733)   ,S(451, 742)   ,
		S(469, 707)   ,S(474, 714)   ,S(467, 739)   ,S(488, 738)   ,S(495, 740)   ,S(469, 733)   ,S(476, 720)   ,S(476, 709)   ,
		S(472, 707)   ,S(485, 714)   ,S(474, 727)   ,S(477, 730)   ,S(472, 730)   ,S(474, 726)   ,S(477, 711)   ,S(481, 716)   ,
		S(483, 698)   ,S(479, 687)   ,S(477, 703)   ,S(456, 719)   ,S(457, 723)   ,S(474, 706)   ,S(488, 703)   ,S(478, 684)   ,
		S(489, 694)   ,S(476, 709)   ,S(456, 712)   ,S(450, 708)   ,S(444, 718)   ,S(451, 725)   ,S(453, 709)   ,S(476, 693)   ,
	},
	{
		S(384, 741)   ,S(353, 738)   ,S(365, 735)   ,S(348, 741)   ,S(338, 746)   ,S(318, 743)   ,S(430, 730)   ,S(394, 750)   ,
		S(390, 729)   ,S(435, 742)   ,S(458, 729)   ,S(437, 723)   ,S(454, 723)   ,S(477, 723)   ,S(472, 732)   ,S(438, 722)   ,
		S(460, 742)   ,S(492, 736)   ,S(492, 734)   ,S(500, 726)   ,S(500, 715)   ,S(503, 729)   ,S(493, 723)   ,S(479, 727)   ,
		S(459, 727)   ,S(499, 726)   ,S(488, 735)   ,S(506, 740)   ,S(517, 737)   ,S(488, 719)   ,S(498, 723)   ,S(475, 726)   ,
		S(475, 712)   ,S(462, 724)   ,S(482, 731)   ,S(496, 737)   ,S(495, 735)   ,S(479, 727)   ,S(481, 708)   ,S(462, 708)   ,
		S(473, 714)   ,S(483, 716)   ,S(486, 728)   ,S(488, 721)   ,S(479, 724)   ,S(479, 717)   ,S(480, 706)   ,S(462, 706)   ,
		S(473, 711)   ,S(498, 694)   ,S(480, 709)   ,S(463, 717)   ,S(459, 714)   ,S(463, 702)   ,S(468, 690)   ,S(477, 679)   ,
		S(485, 698)   ,S(454, 708)   ,S(451, 717)   ,S(447, 707)   ,S(448, 706)   ,S(454, 708)   ,S(469, 706)   ,S(481, 691)   ,
	},
};
const PScore rookTable[2][64] = {
	{
		S(634, 1295)  ,S(629, 1298)  ,S(599, 1310)  ,S(606, 1304)  ,S(599, 1313)  ,S(659, 1305)  ,S(648, 1308)  ,S(653, 1301)  ,
		S(614, 1288)  ,S(600, 1301)  ,S(622, 1293)  ,S(638, 1296)  ,S(623, 1303)  ,S(659, 1282)  ,S(619, 1295)  ,S(626, 1282)  ,
		S(605, 1274)  ,S(659, 1256)  ,S(634, 1270)  ,S(669, 1251)  ,S(683, 1248)  ,S(683, 1264)  ,S(705, 1245)  ,S(636, 1266)  ,
		S(606, 1260)  ,S(627, 1258)  ,S(637, 1258)  ,S(667, 1248)  ,S(654, 1257)  ,S(664, 1258)  ,S(650, 1262)  ,S(631, 1260)  ,
		S(584, 1245)  ,S(584, 1263)  ,S(587, 1257)  ,S(603, 1250)  ,S(593, 1257)  ,S(598, 1263)  ,S(619, 1259)  ,S(597, 1239)  ,
		S(580, 1221)  ,S(590, 1238)  ,S(582, 1234)  ,S(600, 1224)  ,S(596, 1229)  ,S(597, 1234)  ,S(627, 1227)  ,S(596, 1202)  ,
		S(562, 1217)  ,S(593, 1215)  ,S(591, 1221)  ,S(601, 1214)  ,S(598, 1215)  ,S(613, 1210)  ,S(621, 1200)  ,S(547, 1219)  ,
		S(601, 1216)  ,S(602, 1222)  ,S(603, 1222)  ,S(612, 1213)  ,S(610, 1216)  ,S(614, 1233)  ,S(610, 1223)  ,S(599, 1195)  ,
	},
	{
		S(648, 1291)  ,S(607, 1315)  ,S(628, 1311)  ,S(619, 1300)  ,S(626, 1294)  ,S(633, 1286)  ,S(662, 1276)  ,S(664, 1277)  ,
		S(590, 1296)  ,S(612, 1298)  ,S(644, 1289)  ,S(635, 1290)  ,S(636, 1286)  ,S(649, 1270)  ,S(616, 1283)  ,S(629, 1276)  ,
		S(602, 1280)  ,S(661, 1259)  ,S(650, 1275)  ,S(674, 1247)  ,S(688, 1237)  ,S(657, 1253)  ,S(688, 1236)  ,S(631, 1258)  ,
		S(593, 1267)  ,S(637, 1262)  ,S(653, 1259)  ,S(657, 1250)  ,S(657, 1247)  ,S(644, 1249)  ,S(646, 1243)  ,S(630, 1250)  ,
		S(563, 1236)  ,S(596, 1253)  ,S(589, 1262)  ,S(591, 1252)  ,S(593, 1247)  ,S(589, 1254)  ,S(590, 1255)  ,S(589, 1238)  ,
		S(553, 1210)  ,S(597, 1225)  ,S(597, 1227)  ,S(591, 1222)  ,S(589, 1223)  ,S(588, 1226)  ,S(606, 1227)  ,S(584, 1209)  ,
		S(460, 1237)  ,S(574, 1206)  ,S(592, 1216)  ,S(592, 1215)  ,S(596, 1209)  ,S(597, 1206)  ,S(601, 1201)  ,S(556, 1202)  ,
		S(553, 1219)  ,S(579, 1231)  ,S(607, 1221)  ,S(610, 1215)  ,S(608, 1208)  ,S(607, 1212)  ,S(613, 1207)  ,S(599, 1198)  ,
	},
};
const PScore queenTable[2][64] = {
	{
		S(1237, 1449) ,S(1268, 1442) ,S(1249, 1481) ,S(1251, 1490) ,S(1239, 1519) ,S(1273, 1519) ,S(1274, 1486) ,S(1264, 1462) ,
		S(1265, 1425) ,S(1211, 1473) ,S(1262, 1448) ,S(1201, 1517) ,S(1205, 1554) ,S(1284, 1525) ,S(1201, 1526) ,S(1280, 1467) ,
		S(1268, 1425) ,S(1274, 1420) ,S(1261, 1445) ,S(1271, 1459) ,S(1278, 1496) ,S(1284, 1513) ,S(1279, 1514) ,S(1261, 1525) ,
		S(1282, 1411) ,S(1281, 1448) ,S(1272, 1436) ,S(1255, 1506) ,S(1256, 1528) ,S(1291, 1524) ,S(1302, 1516) ,S(1299, 1486) ,
		S(1283, 1389) ,S(1282, 1435) ,S(1272, 1452) ,S(1267, 1501) ,S(1267, 1497) ,S(1284, 1483) ,S(1293, 1460) ,S(1300, 1442) ,
		S(1290, 1369) ,S(1297, 1401) ,S(1287, 1435) ,S(1285, 1430) ,S(1285, 1420) ,S(1289, 1443) ,S(1304, 1405) ,S(1302, 1378) ,
		S(1294, 1359) ,S(1297, 1366) ,S(1304, 1354) ,S(1298, 1389) ,S(1300, 1377) ,S(1318, 1319) ,S(1306, 1323) ,S(1274, 1369) ,
		S(1295, 1352) ,S(1297, 1353) ,S(1303, 1353) ,S(1310, 1383) ,S(1311, 1341) ,S(1284, 1340) ,S(1282, 1311) ,S(1279, 1333) ,
	},
	{
		S(1277, 1398) ,S(1275, 1430) ,S(1271, 1460) ,S(1261, 1494) ,S(1247, 1491) ,S(1268, 1456) ,S(1262, 1435) ,S(1266, 1416) ,
		S(1258, 1441) ,S(1197, 1489) ,S(1268, 1486) ,S(1197, 1542) ,S(1185, 1554) ,S(1264, 1447) ,S(1214, 1474) ,S(1284, 1409) ,
		S(1264, 1465) ,S(1268, 1463) ,S(1256, 1494) ,S(1281, 1485) ,S(1284, 1458) ,S(1270, 1458) ,S(1298, 1406) ,S(1297, 1419) ,
		S(1282, 1447) ,S(1294, 1489) ,S(1284, 1484) ,S(1274, 1513) ,S(1270, 1494) ,S(1285, 1435) ,S(1301, 1441) ,S(1304, 1418) ,
		S(1288, 1404) ,S(1287, 1457) ,S(1280, 1466) ,S(1275, 1493) ,S(1281, 1472) ,S(1280, 1442) ,S(1294, 1416) ,S(1291, 1390) ,
		S(1267, 1395) ,S(1293, 1396) ,S(1291, 1433) ,S(1289, 1410) ,S(1290, 1411) ,S(1294, 1413) ,S(1302, 1387) ,S(1297, 1352) ,
		S(1247, 1363) ,S(1283, 1332) ,S(1313, 1314) ,S(1307, 1363) ,S(1303, 1376) ,S(1311, 1332) ,S(1309, 1340) ,S(1305, 1323) ,
		S(1253, 1337) ,S(1279, 1306) ,S(1285, 1309) ,S(1302, 1324) ,S(1309, 1342) ,S(1311, 1318) ,S(1311, 1331) ,S(1304, 1316) ,
	},
};
const PScore kingTable[2][64] = {
	{
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(89, -41)    ,S(67, -33)    ,S(57, -30)    ,S(-26, -188)  ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(145, 14)    ,S(154, 32)    ,S(74, 64)     ,S(-5, -30)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(166, 43)    ,S(229, 48)    ,S(173, 56)    ,S(37, 9)      ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(117, 63)    ,S(141, 54)    ,S(115, 38)    ,S(-54, 15)    ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(74, 65)     ,S(79, 42)     ,S(75, 14)     ,S(-65, -15)   ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(23, 51)     ,S(26, 29)     ,S(19, 1)      ,S(-46, -16)   ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-66, 38)    ,S(-52, 35)    ,S(-4, -2)     ,S(1, -42)     ,
		S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-68, -28)   ,S(-95, 8)     ,S(-5, -37)    ,S(4, -125)    ,
	},
	{
		S(-18, -199)  ,S(49, -77)    ,S(83, -62)    ,S(101, -34)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-43, -42)   ,S(89, 37)     ,S(145, 17)    ,S(189, -11)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(5, 12)      ,S(172, 43)    ,S(200, 36)    ,S(172, 30)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-42, 13)    ,S(127, 21)    ,S(146, 44)    ,S(119, 50)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-54, -29)   ,S(69, 4)      ,S(113, 25)    ,S(70, 51)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-72, -18)   ,S(11, -9)     ,S(37, 11)     ,S(19, 36)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-11, -36)   ,S(-15, -16)   ,S(-19, 9)     ,S(-69, 22)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-25, -109)  ,S(-11, -54)   ,S(-49, -13)   ,S(-92, -27)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
};

constexpr PScore materialValues[5] = {S(98, 196), S(416, 608), S(429, 649), S(567, 1143), S(1247, 1361), };
constexpr PScore knightMob[9] = {S(-27, -129), S(-8, -52), S(5, -4), S(11, 21), S(16, 31), S(21, 45), S(29, 44), S(39, 38), S(51, 14), };
constexpr PScore bishopMob[14] = {S(-49, -180), S(-18, -105), S(-1, -51), S(7, -22), S(17, -2), S(22, 15), S(25, 28), S(24, 36), S(24, 46), S(28, 47), S(36, 40), S(58, 25), S(63, 32), S(87, -11), };
constexpr PScore rookMob[15] = {S(-22, -138), S(-27, -90), S(-19, -56), S(-17, -40), S(-16, -22), S(-19, -4), S(-15, 6), S(-10, 6), S(-6, 11), S(2, 15), S(2, 21), S(8, 25), S(11, 26), S(28, 5), S(92, -29), };
constexpr PScore queenMob[28] = {S(-129, -447), S(-86, -471), S(-47, -377), S(-30, -287), S(-26, -193), S(-25, -136), S(-20, -101), S(-17, -84), S(-14, -63), S(-10, -52), S(-5, -45), S(0, -41), S(3, -38), S(6, -37), S(8, -37), S(10, -39), S(10, -40), S(6, -37), S(9, -43), S(12, -53), S(26, -77), S(32, -95), S(32, -109), S(43, -132), S(21, -138), S(28, -162), S(-1, -130), S(-8, -103), };

constexpr Score gamephaseInc[12] = { 0, 1, 1, 2, 4, 0, 0, 1, 1, 2, 4, 0 };

//constexpr Score KSAMG = -2;
constexpr double KSCALEMG = 848.7803344726562;
constexpr double KSBMG = 1.69461190700531;
constexpr double KSCMG = -3.154715061187744;
// constexpr Score KSAEG = -71;
constexpr double KSCALEEG = 1104.1273193359375;
constexpr double KSBEG = 2.16499662399292;
constexpr double KSCEG = 2.7506113052368164;

#define PAWNHASHSIZE 262144ULL

struct PawnEvalHashEntry {
    U64 hash;
    PScore score;
    BitBoard passers; // This can be shrinked to add more stuff and keep the alignement
};

extern PawnEvalHashEntry pawnEvalHash[PAWNHASHSIZE];

extern PScore PSQTs[2][12][64];
/**
* @brief The initTables function initializes the material - positional tables
* @note This function is called once at the beginning of the program
*/
void initTables();

/**
 * @brief The pestoEval function evaluates the material and positional scores
 * @param pos The position to evaluate
 * @return The material and positional scores
 */
Score pestoEval(Position* pos);

/** 
 * @brief The initTropism function initializes the tropism tables
 * @note This is called at the start of the program 
 */
void initTropism();

/**
 * @brief The convertToFeatures function converts a set of positions to a set of features
 * @param filename The filename of the epd file
 * @param output The output file to write the features to
 */
void convertToFeatures(std::string filename, std::string output);