#pragma once

#include "BBmacros.h"
#include "Position.h"

const PScore pawnTable[2][64] = {
    {
        S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,
        S(201, 261)   ,S(157, 264)   ,S(199, 208)   ,S(205, 168)   ,S(179, 178)   ,S(118, 227)   ,S(-88, 320)   ,S(-52, 326)   ,
        S(101, 299)   ,S(128, 278)   ,S(150, 233)   ,S(143, 192)   ,S(152, 204)   ,S(204, 240)   ,S(148, 278)   ,S(110, 285)   ,
        S(97, 251)    ,S(101, 234)   ,S(108, 215)   ,S(118, 190)   ,S(126, 206)   ,S(135, 218)   ,S(97, 245)    ,S(94, 239)    ,
        S(89, 225)    ,S(87, 218)    ,S(103, 198)   ,S(110, 194)   ,S(111, 202)   ,S(115, 208)   ,S(97, 215)    ,S(97, 209)    ,
        S(92, 214)    ,S(92, 208)    ,S(99, 205)    ,S(105, 204)   ,S(118, 219)   ,S(109, 222)   ,S(120, 199)   ,S(109, 193)   ,
        S(89, 223)    ,S(89, 213)    ,S(87, 213)    ,S(95, 218)    ,S(96, 236)    ,S(134, 230)   ,S(143, 203)   ,S(110, 182)   ,
        S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,
    },
    {
        S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,
        S(133, 324)   ,S(99, 336)    ,S(175, 297)   ,S(186, 223)   ,S(181, 210)   ,S(202, 183)   ,S(91, 258)    ,S(82, 261)    ,
        S(118, 320)   ,S(172, 314)   ,S(168, 284)   ,S(153, 236)   ,S(162, 208)   ,S(160, 235)   ,S(153, 255)   ,S(94, 277)    ,
        S(127, 249)   ,S(121, 248)   ,S(126, 232)   ,S(129, 216)   ,S(128, 210)   ,S(114, 221)   ,S(82, 246)    ,S(87, 247)    ,
        S(125, 214)   ,S(111, 222)   ,S(122, 210)   ,S(121, 210)   ,S(110, 204)   ,S(98, 215)    ,S(75, 225)    ,S(70, 229)    ,
        S(127, 203)   ,S(136, 198)   ,S(122, 216)   ,S(113, 219)   ,S(101, 215)   ,S(94, 215)    ,S(77, 220)    ,S(69, 221)    ,
        S(130, 199)   ,S(154, 196)   ,S(142, 221)   ,S(107, 233)   ,S(84, 227)    ,S(82, 225)    ,S(73, 226)    ,S(71, 228)    ,
        S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,S(106, 208)   ,
    },
};
const PScore knightTable[2][64] = {
    {
        S(274, 602)   ,S(370, 674)   ,S(354, 722)   ,S(464, 694)   ,S(504, 688)   ,S(378, 726)   ,S(373, 688)   ,S(336, 573)   ,
        S(478, 651)   ,S(484, 674)   ,S(520, 677)   ,S(542, 713)   ,S(551, 714)   ,S(561, 668)   ,S(478, 680)   ,S(499, 653)   ,
        S(474, 661)   ,S(494, 686)   ,S(527, 721)   ,S(526, 728)   ,S(538, 723)   ,S(534, 729)   ,S(473, 711)   ,S(487, 681)   ,
        S(512, 679)   ,S(524, 688)   ,S(536, 720)   ,S(538, 748)   ,S(539, 759)   ,S(545, 735)   ,S(517, 731)   ,S(512, 709)   ,
        S(501, 685)   ,S(515, 694)   ,S(517, 721)   ,S(522, 736)   ,S(530, 745)   ,S(523, 733)   ,S(535, 714)   ,S(504, 715)   ,
        S(477, 639)   ,S(490, 672)   ,S(490, 700)   ,S(500, 726)   ,S(497, 726)   ,S(486, 701)   ,S(483, 690)   ,S(472, 668)   ,
        S(455, 660)   ,S(466, 674)   ,S(470, 668)   ,S(479, 693)   ,S(475, 695)   ,S(465, 672)   ,S(457, 681)   ,S(458, 685)   ,
        S(440, 620)   ,S(467, 635)   ,S(462, 648)   ,S(467, 682)   ,S(462, 683)   ,S(461, 675)   ,S(458, 654)   ,S(421, 644)   ,
    },
    {
        S(300, 563)   ,S(380, 661)   ,S(384, 706)   ,S(482, 683)   ,S(484, 676)   ,S(340, 713)   ,S(353, 683)   ,S(306, 575)   ,
        S(473, 647)   ,S(468, 682)   ,S(519, 681)   ,S(581, 695)   ,S(553, 699)   ,S(546, 670)   ,S(487, 667)   ,S(488, 641)   ,
        S(453, 680)   ,S(498, 697)   ,S(514, 730)   ,S(533, 729)   ,S(545, 718)   ,S(540, 713)   ,S(516, 674)   ,S(479, 661)   ,
        S(499, 693)   ,S(523, 705)   ,S(537, 730)   ,S(552, 741)   ,S(552, 739)   ,S(544, 716)   ,S(522, 704)   ,S(514, 677)   ,
        S(506, 698)   ,S(514, 707)   ,S(525, 723)   ,S(531, 735)   ,S(533, 734)   ,S(523, 719)   ,S(519, 698)   ,S(510, 680)   ,
        S(449, 671)   ,S(475, 685)   ,S(491, 701)   ,S(492, 721)   ,S(495, 720)   ,S(487, 696)   ,S(482, 666)   ,S(463, 641)   ,
        S(446, 693)   ,S(436, 695)   ,S(458, 676)   ,S(470, 689)   ,S(476, 690)   ,S(465, 670)   ,S(448, 678)   ,S(447, 653)   ,
        S(408, 662)   ,S(439, 660)   ,S(450, 673)   ,S(446, 681)   ,S(462, 669)   ,S(463, 642)   ,S(457, 639)   ,S(431, 606)   ,
    },
};
const PScore bishopTable[2][64] = {
    {
        S(457, 766)   ,S(436, 761)   ,S(380, 760)   ,S(370, 768)   ,S(395, 751)   ,S(366, 751)   ,S(458, 741)   ,S(448, 751)   ,
        S(448, 753)   ,S(480, 750)   ,S(494, 736)   ,S(457, 747)   ,S(461, 742)   ,S(484, 736)   ,S(443, 753)   ,S(458, 741)   ,
        S(510, 741)   ,S(506, 744)   ,S(520, 739)   ,S(499, 736)   ,S(509, 735)   ,S(493, 762)   ,S(485, 753)   ,S(487, 760)   ,
        S(493, 744)   ,S(517, 737)   ,S(503, 731)   ,S(520, 748)   ,S(514, 756)   ,S(509, 746)   ,S(509, 754)   ,S(481, 754)   ,
        S(499, 727)   ,S(509, 725)   ,S(507, 742)   ,S(510, 743)   ,S(520, 747)   ,S(504, 746)   ,S(507, 736)   ,S(497, 731)   ,
        S(504, 721)   ,S(522, 725)   ,S(507, 735)   ,S(508, 739)   ,S(505, 741)   ,S(505, 736)   ,S(509, 730)   ,S(504, 735)   ,
        S(518, 712)   ,S(515, 696)   ,S(511, 714)   ,S(493, 730)   ,S(493, 732)   ,S(508, 716)   ,S(522, 710)   ,S(506, 697)   ,
        S(523, 708)   ,S(509, 728)   ,S(491, 733)   ,S(485, 725)   ,S(482, 732)   ,S(487, 737)   ,S(486, 723)   ,S(508, 704)   ,
    },
    {
        S(423, 757)   ,S(392, 751)   ,S(401, 748)   ,S(383, 753)   ,S(370, 757)   ,S(353, 757)   ,S(461, 747)   ,S(433, 768)   ,
        S(417, 748)   ,S(451, 756)   ,S(477, 741)   ,S(449, 737)   ,S(455, 741)   ,S(495, 735)   ,S(492, 748)   ,S(471, 738)   ,
        S(486, 759)   ,S(501, 751)   ,S(502, 744)   ,S(513, 737)   ,S(516, 727)   ,S(522, 738)   ,S(519, 735)   ,S(512, 744)   ,
        S(477, 746)   ,S(514, 741)   ,S(497, 747)   ,S(517, 748)   ,S(533, 742)   ,S(513, 725)   ,S(515, 738)   ,S(507, 740)   ,
        S(498, 730)   ,S(487, 738)   ,S(512, 740)   ,S(521, 743)   ,S(518, 739)   ,S(516, 731)   ,S(518, 718)   ,S(490, 727)   ,
        S(493, 732)   ,S(509, 732)   ,S(512, 738)   ,S(517, 732)   ,S(511, 733)   ,S(512, 724)   ,S(516, 718)   ,S(497, 719)   ,
        S(498, 725)   ,S(528, 703)   ,S(510, 718)   ,S(498, 727)   ,S(495, 725)   ,S(498, 713)   ,S(504, 699)   ,S(511, 691)   ,
        S(515, 709)   ,S(485, 722)   ,S(488, 730)   ,S(484, 722)   ,S(484, 722)   ,S(489, 725)   ,S(500, 724)   ,S(514, 706)   ,
    },
};
const PScore rookTable[2][64] = {
    {
        S(683, 1285)  ,S(678, 1288)  ,S(643, 1301)  ,S(656, 1293)  ,S(626, 1310)  ,S(692, 1303)  ,S(695, 1300)  ,S(689, 1297)  ,
        S(662, 1274)  ,S(652, 1285)  ,S(673, 1279)  ,S(693, 1279)  ,S(663, 1295)  ,S(700, 1272)  ,S(670, 1281)  ,S(669, 1273)  ,
        S(654, 1259)  ,S(709, 1240)  ,S(684, 1255)  ,S(719, 1234)  ,S(721, 1239)  ,S(727, 1253)  ,S(749, 1232)  ,S(676, 1257)  ,
        S(654, 1246)  ,S(677, 1243)  ,S(683, 1245)  ,S(712, 1235)  ,S(692, 1253)  ,S(697, 1252)  ,S(689, 1255)  ,S(669, 1254)  ,
        S(628, 1235)  ,S(633, 1253)  ,S(632, 1249)  ,S(648, 1241)  ,S(633, 1255)  ,S(639, 1262)  ,S(661, 1255)  ,S(633, 1240)  ,
        S(623, 1208)  ,S(636, 1224)  ,S(627, 1220)  ,S(647, 1210)  ,S(636, 1222)  ,S(640, 1225)  ,S(670, 1215)  ,S(636, 1195)  ,
        S(604, 1205)  ,S(637, 1202)  ,S(636, 1209)  ,S(646, 1202)  ,S(640, 1209)  ,S(653, 1203)  ,S(665, 1190)  ,S(585, 1208)  ,
        S(642, 1203)  ,S(644, 1209)  ,S(647, 1209)  ,S(656, 1199)  ,S(651, 1205)  ,S(656, 1222)  ,S(649, 1211)  ,S(638, 1186)  ,
    },
    {
        S(685, 1283)  ,S(651, 1306)  ,S(663, 1306)  ,S(643, 1298)  ,S(673, 1284)  ,S(675, 1278)  ,S(712, 1265)  ,S(711, 1269)  ,
        S(631, 1283)  ,S(660, 1284)  ,S(684, 1279)  ,S(675, 1279)  ,S(691, 1268)  ,S(698, 1255)  ,S(669, 1266)  ,S(679, 1261)  ,
        S(637, 1271)  ,S(706, 1247)  ,S(688, 1265)  ,S(713, 1237)  ,S(736, 1222)  ,S(704, 1239)  ,S(737, 1221)  ,S(679, 1246)  ,
        S(627, 1259)  ,S(676, 1251)  ,S(684, 1254)  ,S(691, 1244)  ,S(700, 1234)  ,S(688, 1235)  ,S(692, 1229)  ,S(675, 1236)  ,
        S(594, 1233)  ,S(635, 1248)  ,S(622, 1261)  ,S(630, 1250)  ,S(637, 1239)  ,S(631, 1246)  ,S(639, 1245)  ,S(631, 1230)  ,
        S(589, 1199)  ,S(641, 1211)  ,S(641, 1214)  ,S(632, 1210)  ,S(636, 1208)  ,S(633, 1212)  ,S(651, 1212)  ,S(627, 1196)  ,
        S(500, 1223)  ,S(620, 1191)  ,S(636, 1203)  ,S(633, 1204)  ,S(640, 1195)  ,S(640, 1193)  ,S(645, 1187)  ,S(598, 1190)  ,
        S(590, 1206)  ,S(620, 1217)  ,S(649, 1209)  ,S(650, 1201)  ,S(651, 1192)  ,S(648, 1197)  ,S(654, 1193)  ,S(641, 1185)  ,
    },
};
const PScore queenTable[2][64] = {
    {
        S(1315, 1482) ,S(1346, 1478) ,S(1321, 1514) ,S(1325, 1522) ,S(1304, 1547) ,S(1350, 1541) ,S(1369, 1513) ,S(1350, 1492) ,
        S(1342, 1461) ,S(1287, 1510) ,S(1337, 1481) ,S(1282, 1544) ,S(1269, 1584) ,S(1353, 1543) ,S(1301, 1548) ,S(1352, 1502) ,
        S(1343, 1460) ,S(1344, 1459) ,S(1329, 1485) ,S(1335, 1499) ,S(1332, 1521) ,S(1328, 1546) ,S(1320, 1543) ,S(1321, 1559) ,
        S(1351, 1448) ,S(1345, 1487) ,S(1336, 1476) ,S(1312, 1544) ,S(1306, 1563) ,S(1336, 1560) ,S(1345, 1557) ,S(1352, 1520) ,
        S(1353, 1433) ,S(1357, 1470) ,S(1342, 1485) ,S(1328, 1545) ,S(1325, 1543) ,S(1342, 1532) ,S(1351, 1503) ,S(1358, 1486) ,
        S(1361, 1410) ,S(1369, 1431) ,S(1357, 1470) ,S(1350, 1467) ,S(1349, 1460) ,S(1350, 1488) ,S(1369, 1445) ,S(1362, 1422) ,
        S(1365, 1396) ,S(1368, 1401) ,S(1375, 1388) ,S(1368, 1427) ,S(1369, 1415) ,S(1388, 1355) ,S(1375, 1363) ,S(1340, 1407) ,
        S(1367, 1385) ,S(1367, 1391) ,S(1374, 1392) ,S(1380, 1418) ,S(1380, 1381) ,S(1357, 1373) ,S(1353, 1353) ,S(1349, 1365) ,
    },
    {
        S(1343, 1436) ,S(1359, 1461) ,S(1341, 1492) ,S(1322, 1525) ,S(1324, 1519) ,S(1347, 1481) ,S(1339, 1471) ,S(1342, 1453) ,
        S(1312, 1479) ,S(1262, 1533) ,S(1323, 1519) ,S(1257, 1571) ,S(1256, 1587) ,S(1337, 1473) ,S(1293, 1507) ,S(1358, 1443) ,
        S(1315, 1502) ,S(1301, 1505) ,S(1293, 1531) ,S(1328, 1510) ,S(1334, 1498) ,S(1334, 1491) ,S(1358, 1448) ,S(1362, 1458) ,
        S(1322, 1480) ,S(1328, 1528) ,S(1315, 1521) ,S(1311, 1545) ,S(1317, 1530) ,S(1339, 1466) ,S(1354, 1480) ,S(1364, 1452) ,
        S(1337, 1441) ,S(1335, 1493) ,S(1329, 1500) ,S(1324, 1529) ,S(1335, 1511) ,S(1343, 1477) ,S(1361, 1452) ,S(1352, 1432) ,
        S(1320, 1432) ,S(1348, 1427) ,S(1346, 1463) ,S(1348, 1443) ,S(1351, 1445) ,S(1356, 1450) ,S(1366, 1425) ,S(1359, 1395) ,
        S(1306, 1395) ,S(1343, 1364) ,S(1376, 1343) ,S(1369, 1395) ,S(1365, 1410) ,S(1374, 1365) ,S(1374, 1375) ,S(1368, 1367) ,
        S(1315, 1364) ,S(1340, 1344) ,S(1351, 1337) ,S(1367, 1355) ,S(1372, 1373) ,S(1374, 1353) ,S(1372, 1366) ,S(1366, 1352) ,
    },
};
const PScore kingTable[2][64] = {
    {
        S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(109, -50)   ,S(74, -35)    ,S(80, -42)    ,S(-5, -180)   ,
        S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(146, 17)    ,S(165, 29)    ,S(81, 60)     ,S(15, -15)    ,
        S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(151, 48)    ,S(218, 52)    ,S(157, 60)    ,S(59, 26)     ,
        S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(80, 77)     ,S(109, 68)    ,S(80, 50)     ,S(-33, 30)    ,
        S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(24, 76)     ,S(36, 55)     ,S(30, 25)     ,S(-35, -1)    ,
        S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-19, 58)    ,S(-10, 37)    ,S(-20, 8)     ,S(-5, -6)     ,
        S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-94, 33)    ,S(-75, 32)    ,S(-22, -9)    ,S(48, -42)    ,
        S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(-80, -41)   ,S(-100, -2)   ,S(-11, -49)   ,S(45, -124)   ,
    },
    {
        S(10, -206)   ,S(73, -80)    ,S(111, -68)   ,S(124, -43)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
        S(-20, -51)   ,S(109, 33)    ,S(157, 18)    ,S(202, -12)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
        S(7, 8)       ,S(162, 47)    ,S(185, 46)    ,S(161, 37)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
        S(-49, 12)    ,S(99, 34)     ,S(113, 59)    ,S(89, 63)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
        S(-66, -29)   ,S(31, 17)     ,S(73, 40)     ,S(30, 63)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
        S(-79, -21)   ,S(-19, -2)    ,S(4, 21)      ,S(-16, 42)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
        S(-4, -48)    ,S(-19, -23)   ,S(-30, 4)     ,S(-88, 15)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
        S(-10, -128)  ,S(-2, -68)    ,S(-42, -25)   ,S(-93, -40)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
    },
};

constexpr PScore materialValues[5] = {S(106, 208), S(461, 647), S(470, 685), S(637, 1195), S(1340, 1432), };
constexpr PScore knightMob[9] = {S(-39, -147), S(-20, -69), S(-10, -23), S(-3, 2), S(3, 14), S(8, 28), S(15, 28), S(25, 23), S(35, 0), };
constexpr PScore bishopMob[14] = {S(-56, -198), S(-28, -124), S(-13, -72), S(-6, -43), S(4, -21), S(8, 0), S(11, 15), S(11, 24), S(12, 36), S(19, 40), S(27, 35), S(52, 21), S(63, 29), S(86, -13), };
constexpr PScore rookMob[15] = {S(-27, -133), S(-33, -88), S(-25, -53), S(-24, -36), S(-23, -17), S(-25, 1), S(-22, 11), S(-17, 12), S(-13, 18), S(-5, 24), S(-6, 31), S(0, 36), S(3, 39), S(19, 20), S(81, -14), };
constexpr PScore queenMob[28] = {S(-139, -392), S(-98, -406), S(-62, -312), S(-44, -225), S(-41, -129), S(-39, -71), S(-35, -35), S(-32, -16), S(-29, 5), S(-24, 18), S(-19, 26), S(-14, 32), S(-11, 34), S(-7, 37), S(-5, 37), S(-2, 37), S(-2, 33), S(-5, 33), S(-2, 26), S(3, 15), S(15, -10), S(21, -31), S(19, -44), S(28, -68), S(1, -74), S(9, -105), S(-31, -70), S(-32, -51), };

constexpr Score gamephaseInc[12] = { 0, 1, 1, 2, 4, 0, 0, 1, 1, 2, 4, 0 };

//constexpr Score KSAMG = -2;
constexpr double KSCALEMG = 896.5775756835938;
constexpr double KSBMG = 1; 
constexpr double KSCMG = -2.5930113792419434;
// constexpr Score KSAEG = -71;
constexpr double KSCALEEG = 1056.3033447265625;
constexpr double KSBEG = 1;
constexpr double KSCEG = 2.246932029724121;

constexpr PScore DAMPEN = S(static_cast<S16>(0.09197794646024704 * RESOLUTION), static_cast<S16>(0.844261884689331 * RESOLUTION));

#define PAWNHASHSIZE 262144ULL

struct PawnEvalHashEntry {
    U64 hash;
    PScore score;
    BitBoard passers; // This can be shrinked to add more stuff and keep the alignement
};

extern PawnEvalHashEntry pawnEvalHash[PAWNHASHSIZE];

extern PScore PSQTs[2][12][64];
/**
* @brief The initTables function initializes the material - positional tables
* @note This function is called once at the beginning of the program
*/
void initTables();

/**
 * @brief The pestoEval function evaluates the material and positional scores
 * @param pos The position to evaluate
 * @return The material and positional scores
 */
Score pestoEval(Position* pos);

/** 
 * @brief The initTropism function initializes the tropism tables
 * @note This is called at the start of the program 
 */
void initTropism();

/**
 * @brief The convertToFeatures function converts a set of positions to a set of features
 * @param filename The filename of the epd file
 * @param output The output file to write the features to
 */
void convertToFeatures(std::string filename, std::string output);