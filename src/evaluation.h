#pragma once

#include "BBmacros.h"
#include "Position.h"

const PScore pawnTable[2][64] = {
	{
		S(78, 149)    ,S(78, 149)    ,S(78, 148)    ,S(78, 148)    ,S(78, 149)    ,S(78, 148)    ,S(78, 148)    ,S(78, 149)    ,
		S(279, 508)   ,S(286, 523)   ,S(241, 496)   ,S(265, 413)   ,S(291, 305)   ,S(263, 247)   ,S(121, 309)   ,S(76, 341)    ,
		S(69, 446)    ,S(136, 447)   ,S(139, 409)   ,S(154, 341)   ,S(200, 254)   ,S(203, 213)   ,S(151, 248)   ,S(65, 270)    ,
		S(98, 286)    ,S(122, 274)   ,S(107, 251)   ,S(109, 223)   ,S(143, 183)   ,S(132, 176)   ,S(93, 205)    ,S(46, 209)    ,
		S(102, 220)   ,S(123, 227)   ,S(99, 205)    ,S(93, 199)    ,S(103, 180)   ,S(89, 184)    ,S(74, 201)    ,S(27, 202)    ,
		S(116, 190)   ,S(155, 198)   ,S(102, 195)   ,S(81, 201)    ,S(79, 197)    ,S(65, 195)    ,S(49, 215)    ,S(17, 209)    ,
		S(115, 192)   ,S(169, 195)   ,S(122, 201)   ,S(69, 217)    ,S(57, 215)    ,S(49, 213)    ,S(37, 232)    ,S(13, 221)    ,
		S(78, 149)    ,S(78, 149)    ,S(78, 149)    ,S(78, 149)    ,S(78, 149)    ,S(78, 149)    ,S(78, 148)    ,S(78, 148)    ,
	},
	{
		S(78, 148)    ,S(78, 149)    ,S(78, 148)    ,S(78, 149)    ,S(78, 148)    ,S(78, 148)    ,S(78, 149)    ,S(78, 149)    ,
		S(65, 374)    ,S(91, 348)    ,S(296, 273)   ,S(325, 286)   ,S(298, 342)   ,S(281, 402)   ,S(278, 443)   ,S(282, 438)   ,
		S(89, 282)    ,S(163, 285)   ,S(214, 231)   ,S(177, 257)   ,S(164, 290)   ,S(148, 326)   ,S(120, 352)   ,S(62, 352)    ,
		S(87, 203)    ,S(119, 211)   ,S(124, 185)   ,S(128, 181)   ,S(112, 190)   ,S(94, 211)    ,S(96, 229)    ,S(66, 248)    ,
		S(81, 180)    ,S(111, 195)   ,S(96, 182)    ,S(100, 178)   ,S(89, 180)    ,S(80, 180)    ,S(84, 205)    ,S(57, 211)    ,
		S(92, 170)    ,S(128, 193)   ,S(86, 193)    ,S(91, 196)    ,S(75, 190)    ,S(71, 185)    ,S(78, 200)    ,S(53, 201)    ,
		S(90, 164)    ,S(139, 197)   ,S(103, 213)   ,S(67, 218)    ,S(61, 206)    ,S(59, 199)    ,S(72, 209)    ,S(50, 211)    ,
		S(78, 149)    ,S(78, 149)    ,S(78, 148)    ,S(78, 149)    ,S(78, 149)    ,S(78, 149)    ,S(78, 148)    ,S(78, 149)    ,
	},
};
const PScore knightTable[2][64] = {
	{
		S(214, 421)   ,S(242, 525)   ,S(298, 557)   ,S(417, 531)   ,S(420, 529)   ,S(303, 551)   ,S(383, 506)   ,S(235, 389)   ,
		S(376, 485)   ,S(404, 526)   ,S(475, 534)   ,S(497, 565)   ,S(480, 558)   ,S(489, 536)   ,S(411, 522)   ,S(423, 483)   ,
		S(358, 531)   ,S(455, 552)   ,S(489, 582)   ,S(509, 581)   ,S(539, 575)   ,S(562, 571)   ,S(501, 542)   ,S(444, 514)   ,
		S(386, 541)   ,S(422, 578)   ,S(469, 591)   ,S(479, 608)   ,S(464, 614)   ,S(467, 603)   ,S(435, 581)   ,S(420, 532)   ,
		S(386, 533)   ,S(413, 569)   ,S(422, 599)   ,S(415, 606)   ,S(435, 603)   ,S(423, 600)   ,S(433, 567)   ,S(391, 534)   ,
		S(347, 504)   ,S(377, 550)   ,S(389, 564)   ,S(395, 586)   ,S(405, 588)   ,S(385, 566)   ,S(381, 544)   ,S(344, 506)   ,
		S(342, 493)   ,S(340, 532)   ,S(366, 537)   ,S(364, 552)   ,S(372, 555)   ,S(365, 544)   ,S(317, 542)   ,S(308, 507)   ,
		S(308, 430)   ,S(313, 497)   ,S(341, 505)   ,S(334, 530)   ,S(332, 519)   ,S(320, 502)   ,S(329, 480)   ,S(287, 466)   ,
	},
	{
		S(262, 399)   ,S(351, 552)   ,S(283, 604)   ,S(409, 575)   ,S(350, 582)   ,S(251, 609)   ,S(223, 569)   ,S(142, 472)   ,
		S(432, 525)   ,S(386, 558)   ,S(513, 553)   ,S(452, 601)   ,S(448, 606)   ,S(415, 582)   ,S(355, 564)   ,S(350, 519)   ,
		S(416, 562)   ,S(459, 605)   ,S(548, 618)   ,S(504, 610)   ,S(457, 623)   ,S(444, 620)   ,S(399, 588)   ,S(344, 548)   ,
		S(399, 578)   ,S(408, 637)   ,S(440, 647)   ,S(413, 656)   ,S(430, 651)   ,S(414, 626)   ,S(389, 604)   ,S(361, 554)   ,
		S(378, 570)   ,S(413, 609)   ,S(393, 639)   ,S(397, 643)   ,S(386, 641)   ,S(387, 630)   ,S(368, 596)   ,S(357, 550)   ,
		S(354, 531)   ,S(379, 579)   ,S(377, 593)   ,S(384, 611)   ,S(378, 611)   ,S(369, 587)   ,S(358, 563)   ,S(339, 504)   ,
		S(354, 530)   ,S(347, 555)   ,S(362, 557)   ,S(358, 579)   ,S(362, 575)   ,S(347, 556)   ,S(326, 550)   ,S(310, 511)   ,
		S(307, 458)   ,S(340, 499)   ,S(348, 537)   ,S(333, 545)   ,S(330, 537)   ,S(327, 507)   ,S(335, 471)   ,S(301, 456)   ,
	},
};
const PScore bishopTable[2][64] = {
	{
		S(360, 615)   ,S(355, 612)   ,S(357, 610)   ,S(346, 622)   ,S(307, 617)   ,S(327, 604)   ,S(491, 577)   ,S(418, 584)   ,
		S(397, 588)   ,S(420, 625)   ,S(457, 615)   ,S(421, 615)   ,S(445, 606)   ,S(509, 582)   ,S(492, 587)   ,S(392, 555)   ,
		S(430, 603)   ,S(483, 617)   ,S(493, 618)   ,S(507, 612)   ,S(539, 595)   ,S(569, 596)   ,S(521, 588)   ,S(470, 581)   ,
		S(439, 598)   ,S(464, 621)   ,S(485, 625)   ,S(508, 623)   ,S(524, 614)   ,S(483, 601)   ,S(468, 616)   ,S(446, 582)   ,
		S(430, 583)   ,S(459, 610)   ,S(464, 622)   ,S(487, 617)   ,S(465, 620)   ,S(449, 616)   ,S(440, 597)   ,S(427, 582)   ,
		S(445, 572)   ,S(463, 592)   ,S(465, 608)   ,S(446, 609)   ,S(442, 611)   ,S(421, 607)   ,S(421, 592)   ,S(408, 577)   ,
		S(443, 545)   ,S(479, 571)   ,S(445, 578)   ,S(429, 590)   ,S(412, 595)   ,S(414, 582)   ,S(405, 577)   ,S(406, 563)   ,
		S(431, 538)   ,S(383, 552)   ,S(404, 562)   ,S(387, 572)   ,S(386, 567)   ,S(381, 547)   ,S(385, 572)   ,S(405, 549)   ,
	},
	{
		S(384, 610)   ,S(441, 605)   ,S(303, 631)   ,S(324, 641)   ,S(299, 655)   ,S(291, 642)   ,S(335, 637)   ,S(346, 636)   ,
		S(405, 591)   ,S(440, 623)   ,S(464, 617)   ,S(417, 635)   ,S(392, 644)   ,S(411, 639)   ,S(412, 638)   ,S(355, 610)   ,
		S(434, 633)   ,S(489, 643)   ,S(507, 649)   ,S(486, 638)   ,S(460, 635)   ,S(457, 640)   ,S(422, 644)   ,S(402, 621)   ,
		S(410, 626)   ,S(422, 660)   ,S(453, 653)   ,S(450, 667)   ,S(475, 654)   ,S(435, 641)   ,S(425, 645)   ,S(387, 622)   ,
		S(408, 604)   ,S(411, 634)   ,S(413, 649)   ,S(436, 653)   ,S(428, 656)   ,S(422, 654)   ,S(413, 632)   ,S(393, 604)   ,
		S(422, 604)   ,S(411, 613)   ,S(410, 635)   ,S(411, 643)   ,S(416, 638)   ,S(410, 638)   ,S(416, 620)   ,S(400, 602)   ,
		S(413, 550)   ,S(427, 600)   ,S(404, 602)   ,S(397, 619)   ,S(395, 618)   ,S(408, 601)   ,S(408, 589)   ,S(407, 582)   ,
		S(396, 549)   ,S(370, 575)   ,S(385, 589)   ,S(370, 592)   ,S(377, 591)   ,S(380, 567)   ,S(395, 579)   ,S(406, 565)   ,
	},
};
const PScore rookTable[2][64] = {
	{
		S(700, 997)   ,S(654, 1022)  ,S(643, 1035)  ,S(628, 1042)  ,S(648, 1030)  ,S(727, 1006)  ,S(696, 1009)  ,S(660, 1021)  ,
		S(623, 1010)  ,S(619, 1023)  ,S(644, 1024)  ,S(632, 1045)  ,S(654, 1028)  ,S(705, 1001)  ,S(651, 1008)  ,S(645, 995)   ,
		S(590, 1014)  ,S(627, 1002)  ,S(616, 1024)  ,S(623, 1019)  ,S(648, 1006)  ,S(650, 1012)  ,S(677, 990)   ,S(609, 1002)  ,
		S(555, 1014)  ,S(553, 1019)  ,S(576, 1020)  ,S(580, 1027)  ,S(588, 1014)  ,S(575, 1019)  ,S(585, 1001)  ,S(569, 994)   ,
		S(507, 998)   ,S(520, 1009)  ,S(502, 1027)  ,S(508, 1028)  ,S(519, 1008)  ,S(526, 1009)  ,S(528, 1003)  ,S(509, 991)   ,
		S(463, 979)   ,S(513, 986)   ,S(479, 1003)  ,S(486, 1008)  ,S(495, 993)   ,S(507, 987)   ,S(525, 982)   ,S(495, 969)   ,
		S(421, 985)   ,S(477, 979)   ,S(500, 988)   ,S(487, 998)   ,S(499, 988)   ,S(515, 979)   ,S(524, 966)   ,S(472, 973)   ,
		S(468, 983)   ,S(496, 995)   ,S(512, 995)   ,S(514, 1002)  ,S(522, 992)   ,S(537, 988)   ,S(536, 977)   ,S(506, 972)   ,
	},
	{
		S(685, 1053)  ,S(656, 1070)  ,S(680, 1066)  ,S(642, 1069)  ,S(625, 1073)  ,S(604, 1084)  ,S(615, 1073)  ,S(600, 1071)  ,
		S(653, 1038)  ,S(640, 1050)  ,S(708, 1032)  ,S(608, 1083)  ,S(613, 1083)  ,S(588, 1087)  ,S(551, 1090)  ,S(551, 1077)  ,
		S(600, 1045)  ,S(672, 1031)  ,S(660, 1047)  ,S(628, 1044)  ,S(597, 1059)  ,S(567, 1075)  ,S(569, 1059)  ,S(521, 1072)  ,
		S(551, 1044)  ,S(571, 1045)  ,S(564, 1054)  ,S(558, 1056)  ,S(566, 1063)  ,S(537, 1069)  ,S(520, 1063)  ,S(506, 1060)  ,
		S(492, 1026)  ,S(525, 1041)  ,S(502, 1054)  ,S(500, 1048)  ,S(504, 1059)  ,S(490, 1063)  ,S(481, 1059)  ,S(482, 1038)  ,
		S(475, 991)   ,S(526, 1019)  ,S(487, 1028)  ,S(489, 1028)  ,S(489, 1033)  ,S(481, 1033)  ,S(488, 1033)  ,S(468, 1016)  ,
		S(409, 1013)  ,S(511, 1004)  ,S(505, 1012)  ,S(493, 1018)  ,S(494, 1021)  ,S(492, 1020)  ,S(484, 1011)  ,S(445, 1016)  ,
		S(476, 986)   ,S(509, 1029)  ,S(502, 1030)  ,S(508, 1029)  ,S(511, 1035)  ,S(506, 1037)  ,S(497, 1025)  ,S(494, 1013)  ,
	},
};
const PScore queenTable[2][64] = {
	{
		S(1202, 1842) ,S(1246, 1852) ,S(1264, 1872) ,S(1252, 1915) ,S(1296, 1884) ,S(1422, 1818) ,S(1300, 1887) ,S(1264, 1877) ,
		S(1192, 1821) ,S(1163, 1903) ,S(1218, 1907) ,S(1179, 1965) ,S(1190, 1988) ,S(1332, 1871) ,S(1250, 1922) ,S(1247, 1883) ,
		S(1184, 1834) ,S(1214, 1829) ,S(1208, 1892) ,S(1225, 1914) ,S(1262, 1929) ,S(1325, 1930) ,S(1336, 1857) ,S(1278, 1871) ,
		S(1193, 1801) ,S(1169, 1885) ,S(1184, 1885) ,S(1195, 1935) ,S(1216, 1947) ,S(1227, 1934) ,S(1234, 1919) ,S(1226, 1885) ,
		S(1172, 1796) ,S(1179, 1857) ,S(1170, 1888) ,S(1185, 1923) ,S(1183, 1907) ,S(1191, 1901) ,S(1199, 1871) ,S(1204, 1856) ,
		S(1148, 1782) ,S(1176, 1813) ,S(1180, 1847) ,S(1174, 1842) ,S(1181, 1831) ,S(1185, 1842) ,S(1203, 1810) ,S(1199, 1823) ,
		S(1113, 1733) ,S(1157, 1763) ,S(1200, 1731) ,S(1189, 1794) ,S(1178, 1789) ,S(1197, 1770) ,S(1196, 1777) ,S(1190, 1795) ,
		S(1123, 1675) ,S(1144, 1678) ,S(1152, 1730) ,S(1154, 1770) ,S(1176, 1750) ,S(1161, 1750) ,S(1157, 1787) ,S(1172, 1758) ,
	},
	{
		S(1273, 1970) ,S(1317, 1962) ,S(1335, 1946) ,S(1243, 1965) ,S(1225, 1951) ,S(1202, 1945) ,S(1176, 1937) ,S(1130, 1939) ,
		S(1270, 1966) ,S(1213, 2055) ,S(1328, 1947) ,S(1177, 2025) ,S(1149, 1990) ,S(1171, 1938) ,S(1121, 1944) ,S(1152, 1883) ,
		S(1237, 1985) ,S(1285, 1992) ,S(1296, 1992) ,S(1219, 1988) ,S(1193, 1942) ,S(1170, 1915) ,S(1161, 1881) ,S(1156, 1863) ,
		S(1210, 1959) ,S(1204, 1995) ,S(1200, 2005) ,S(1180, 1992) ,S(1174, 1953) ,S(1173, 1895) ,S(1162, 1893) ,S(1161, 1843) ,
		S(1201, 1913) ,S(1195, 1907) ,S(1182, 1931) ,S(1171, 1933) ,S(1168, 1940) ,S(1172, 1883) ,S(1176, 1873) ,S(1171, 1825) ,
		S(1191, 1828) ,S(1199, 1835) ,S(1179, 1875) ,S(1172, 1856) ,S(1171, 1856) ,S(1174, 1869) ,S(1181, 1839) ,S(1170, 1805) ,
		S(1149, 1784) ,S(1186, 1765) ,S(1192, 1766) ,S(1182, 1813) ,S(1177, 1825) ,S(1184, 1798) ,S(1174, 1820) ,S(1168, 1796) ,
		S(1140, 1707) ,S(1136, 1757) ,S(1146, 1793) ,S(1172, 1778) ,S(1179, 1792) ,S(1168, 1787) ,S(1164, 1788) ,S(1164, 1809) ,
	},
};
const PScore kingTable[2][64] = {
	{
		S(138, -197)  ,S(209, -108)  ,S(127, -69)   ,S(75, -37)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(30, -28)    ,S(75, 37)     ,S(96, 24)     ,S(66, 18)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(3, 21)      ,S(67, 59)     ,S(86, 55)     ,S(33, 58)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-56, 23)    ,S(8, 57)      ,S(15, 64)     ,S(-30, 74)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-33, -13)   ,S(-12, 34)    ,S(-21, 52)    ,S(-62, 68)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-42, -19)   ,S(-36, 7)     ,S(-63, 29)    ,S(-79, 45)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(25, -48)    ,S(-9, -21)    ,S(-46, 1)     ,S(-82, 16)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(37, -117)   ,S(29, -68)    ,S(-23, -46)   ,S(-36, -66)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
	{
		S(40, -151)   ,S(0, 11)      ,S(54, -15)    ,S(59, -32)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-82, -3)    ,S(2, 74)      ,S(75, 27)     ,S(80, 18)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-65, 34)    ,S(110, 69)    ,S(167, 50)    ,S(84, 41)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-92, 26)    ,S(22, 55)     ,S(47, 61)     ,S(-12, 69)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-79, -2)    ,S(11, 28)     ,S(-18, 55)    ,S(-25, 66)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-50, -10)   ,S(-10, 4)     ,S(-46, 33)    ,S(-47, 45)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(21, -38)    ,S(3, -12)     ,S(-51, 15)    ,S(-63, 16)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(32, -101)   ,S(17, -42)    ,S(-35, -30)   ,S(-23, -71)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
};

constexpr PScore materialValues[5] = {S(109, 204), S(465, 658), S(475, 696), S(638, 1216), S(1358, 2209), };
constexpr PScore knightMob[9] = {S(-42, -156), S(-22, -80), S(-11, -32), S(-4, -5), S(2, 8), S(6, 22), S(14, 24), S(24, 19), S(35, -5), };
constexpr PScore bishopMob[14] = {S(-60, -203), S(-32, -130), S(-16, -78), S(-9, -48), S(3, -26), S(7, -5), S(11, 10), S(12, 20), S(14, 30), S(21, 33), S(30, 27), S(56, 12), S(67, 19), S(89, -25), };
constexpr PScore rookMob[15] = {S(-25, -142), S(-33, -98), S(-24, -62), S(-23, -43), S(-23, -23), S(-24, -6), S(-21, 5), S(-16, 6), S(-12, 13), S(-4, 19), S(-3, 26), S(2, 31), S(4, 35), S(21, 16), S(86, -19), };
constexpr PScore queenMob[28] = {S(-147, -388), S(-107, -401), S(-69, -314), S(-49, -227), S(-46, -130), S(-44, -71), S(-39, -32), S(-36, -13), S(-33, 11), S(-28, 25), S(-23, 34), S(-18, 40), S(-14, 44), S(-11, 48), S(-8, 49), S(-6, 48), S(-6, 46), S(-8, 47), S(-4, 40), S(0, 29), S(14, 3), S(23, -21), S(22, -36), S(36, -65), S(11, -69), S(17, -98), S(-15, -71), S(-28, -33), };

constexpr Score gamephaseInc[12] = { 0, 1, 1, 2, 4, 0, 0, 1, 1, 2, 4, 0 };

//constexpr Score KSAMG = -2;
constexpr double KSCALEMG = 830.890869140625;
constexpr double KSBMG = 1; 
constexpr double KSCMG = -2.920008897781372;
// constexpr Score KSAEG = -71;
constexpr double KSCALEEG = 205.7107391357422;
constexpr double KSBEG = 1;
constexpr double KSCEG = -0.43312424421310425;

#define PAWNHASHSIZE 262144ULL

struct PawnEvalHashEntry {
    U64 hash;
    PScore score;
    BitBoard passers; // This can be shrinked to add more stuff and keep the alignement
};

extern PawnEvalHashEntry pawnEvalHash[PAWNHASHSIZE];

extern PScore PSQTs[2][12][64];
/**
* @brief The initTables function initializes the material - positional tables
* @note This function is called once at the beginning of the program
*/
void initTables();

/**
 * @brief The pestoEval function evaluates the material and positional scores
 * @param pos The position to evaluate
 * @return The material and positional scores
 */
Score pestoEval(Position* pos);

/** 
 * @brief The initTropism function initializes the tropism tables
 * @note This is called at the start of the program 
 */
void initTropism();

/**
 * @brief The convertToFeatures function converts a set of positions to a set of features
 * @param filename The filename of the epd file
 * @param output The output file to write the features to
 */
void convertToFeatures(std::string filename, std::string output);