#pragma once

#include "BBmacros.h"
#include "Position.h"

const PScore pawnTable[2][64] = {
	{
		S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,
		S(233, 416)   ,S(209, 425)   ,S(159, 397)   ,S(197, 279)   ,S(230, 146)   ,S(185, 74)    ,S(1, 147)     ,S(-3, 197)    ,
		S(101, 395)   ,S(127, 384)   ,S(119, 339)   ,S(132, 237)   ,S(182, 136)   ,S(223, 120)   ,S(168, 154)   ,S(110, 203)   ,
		S(117, 287)   ,S(118, 262)   ,S(116, 237)   ,S(118, 202)   ,S(144, 169)   ,S(141, 167)   ,S(86, 198)    ,S(79, 206)    ,
		S(122, 230)   ,S(118, 224)   ,S(120, 207)   ,S(116, 196)   ,S(118, 182)   ,S(107, 190)   ,S(77, 199)    ,S(65, 210)    ,
		S(133, 202)   ,S(150, 195)   ,S(124, 208)   ,S(117, 207)   ,S(107, 201)   ,S(93, 205)    ,S(65, 210)    ,S(63, 214)    ,
		S(132, 197)   ,S(165, 190)   ,S(145, 205)   ,S(101, 220)   ,S(89, 216)    ,S(79, 218)    ,S(62, 223)    ,S(61, 220)    ,
		S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,
	},
	{
		S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,
		S(-33, 253)   ,S(-48, 200)   ,S(190, 113)   ,S(232, 137)   ,S(226, 200)   ,S(200, 280)   ,S(178, 339)   ,S(224, 336)   ,
		S(124, 222)   ,S(165, 198)   ,S(231, 165)   ,S(155, 155)   ,S(139, 181)   ,S(131, 247)   ,S(114, 294)   ,S(100, 315)   ,
		S(100, 214)   ,S(104, 207)   ,S(140, 181)   ,S(135, 179)   ,S(123, 167)   ,S(111, 200)   ,S(108, 221)   ,S(103, 246)   ,
		S(94, 201)    ,S(102, 202)   ,S(119, 196)   ,S(118, 188)   ,S(116, 180)   ,S(109, 187)   ,S(97, 205)    ,S(96, 219)    ,
		S(107, 191)   ,S(122, 195)   ,S(112, 217)   ,S(124, 210)   ,S(112, 190)   ,S(107, 195)   ,S(104, 196)   ,S(99, 207)    ,
		S(108, 173)   ,S(140, 198)   ,S(134, 228)   ,S(101, 229)   ,S(101, 205)   ,S(95, 201)    ,S(99, 199)    ,S(96, 213)    ,
		S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,S(109, 198)   ,
	},
};
const PScore knightTable[2][64] = {
	{
		S(330, 591)   ,S(361, 664)   ,S(388, 698)   ,S(512, 659)   ,S(506, 654)   ,S(399, 681)   ,S(472, 642)   ,S(351, 549)   ,
		S(491, 639)   ,S(515, 658)   ,S(554, 654)   ,S(589, 679)   ,S(580, 665)   ,S(576, 638)   ,S(516, 648)   ,S(536, 620)   ,
		S(464, 668)   ,S(530, 668)   ,S(553, 702)   ,S(559, 697)   ,S(570, 680)   ,S(555, 681)   ,S(522, 653)   ,S(530, 639)   ,
		S(511, 683)   ,S(543, 681)   ,S(568, 703)   ,S(576, 714)   ,S(574, 715)   ,S(562, 700)   ,S(546, 686)   ,S(553, 669)   ,
		S(511, 689)   ,S(535, 688)   ,S(537, 708)   ,S(545, 713)   ,S(559, 712)   ,S(551, 698)   ,S(562, 682)   ,S(540, 682)   ,
		S(470, 651)   ,S(486, 671)   ,S(502, 685)   ,S(504, 707)   ,S(517, 706)   ,S(499, 684)   ,S(503, 659)   ,S(482, 647)   ,
		S(452, 665)   ,S(450, 679)   ,S(470, 661)   ,S(480, 680)   ,S(490, 680)   ,S(484, 663)   ,S(456, 680)   ,S(459, 672)   ,
		S(431, 618)   ,S(438, 666)   ,S(460, 663)   ,S(467, 683)   ,S(467, 673)   ,S(462, 657)   ,S(463, 655)   ,S(432, 650)   ,
	},
	{
		S(356, 571)   ,S(451, 695)   ,S(388, 743)   ,S(503, 713)   ,S(464, 719)   ,S(344, 752)   ,S(352, 710)   ,S(272, 638)   ,
		S(529, 681)   ,S(489, 697)   ,S(580, 680)   ,S(564, 724)   ,S(548, 729)   ,S(523, 698)   ,S(480, 700)   ,S(475, 676)   ,
		S(498, 701)   ,S(485, 728)   ,S(558, 732)   ,S(548, 728)   ,S(535, 741)   ,S(530, 740)   ,S(498, 707)   ,S(466, 687)   ,
		S(523, 729)   ,S(527, 745)   ,S(550, 750)   ,S(545, 773)   ,S(542, 765)   ,S(539, 737)   ,S(524, 711)   ,S(505, 703)   ,
		S(511, 740)   ,S(540, 734)   ,S(529, 748)   ,S(535, 765)   ,S(522, 756)   ,S(518, 742)   ,S(510, 720)   ,S(502, 708)   ,
		S(475, 692)   ,S(486, 708)   ,S(489, 717)   ,S(499, 745)   ,S(501, 742)   ,S(492, 719)   ,S(489, 691)   ,S(479, 660)   ,
		S(462, 712)   ,S(457, 711)   ,S(466, 695)   ,S(477, 718)   ,S(480, 716)   ,S(470, 693)   ,S(466, 698)   ,S(454, 692)   ,
		S(424, 676)   ,S(459, 681)   ,S(461, 704)   ,S(460, 710)   ,S(468, 708)   ,S(466, 676)   ,S(470, 662)   ,S(439, 651)   ,
	},
};
const PScore bishopTable[2][64] = {
	{
		S(471, 766)   ,S(423, 759)   ,S(434, 749)   ,S(397, 759)   ,S(384, 748)   ,S(388, 743)   ,S(530, 731)   ,S(470, 755)   ,
		S(473, 753)   ,S(484, 755)   ,S(516, 741)   ,S(471, 738)   ,S(481, 729)   ,S(534, 707)   ,S(492, 729)   ,S(459, 725)   ,
		S(524, 750)   ,S(543, 743)   ,S(534, 741)   ,S(527, 733)   ,S(549, 712)   ,S(547, 722)   ,S(522, 718)   ,S(530, 733)   ,
		S(520, 751)   ,S(539, 741)   ,S(530, 747)   ,S(537, 743)   ,S(563, 727)   ,S(537, 708)   ,S(549, 725)   ,S(523, 729)   ,
		S(517, 733)   ,S(530, 731)   ,S(532, 738)   ,S(552, 731)   ,S(541, 728)   ,S(536, 722)   ,S(539, 708)   ,S(524, 723)   ,
		S(521, 721)   ,S(549, 722)   ,S(546, 727)   ,S(532, 723)   ,S(534, 725)   ,S(520, 718)   ,S(526, 715)   ,S(511, 721)   ,
		S(535, 707)   ,S(561, 704)   ,S(534, 713)   ,S(520, 720)   ,S(508, 723)   ,S(515, 712)   ,S(515, 702)   ,S(522, 711)   ,
		S(533, 710)   ,S(495, 721)   ,S(508, 728)   ,S(500, 723)   ,S(497, 725)   ,S(497, 735)   ,S(510, 734)   ,S(528, 711)   ,
	},
	{
		S(455, 768)   ,S(485, 757)   ,S(369, 773)   ,S(396, 780)   ,S(373, 797)   ,S(377, 788)   ,S(437, 787)   ,S(458, 793)   ,
		S(476, 761)   ,S(456, 764)   ,S(490, 751)   ,S(467, 762)   ,S(461, 772)   ,S(493, 768)   ,S(479, 781)   ,S(450, 783)   ,
		S(495, 785)   ,S(491, 776)   ,S(505, 777)   ,S(521, 754)   ,S(505, 760)   ,S(521, 766)   ,S(505, 776)   ,S(513, 770)   ,
		S(489, 779)   ,S(514, 773)   ,S(515, 764)   ,S(522, 776)   ,S(525, 772)   ,S(505, 761)   ,S(521, 766)   ,S(493, 777)   ,
		S(502, 756)   ,S(511, 758)   ,S(507, 766)   ,S(525, 769)   ,S(514, 767)   ,S(513, 768)   ,S(514, 751)   ,S(502, 756)   ,
		S(507, 756)   ,S(510, 747)   ,S(507, 755)   ,S(507, 764)   ,S(511, 761)   ,S(513, 758)   ,S(529, 749)   ,S(510, 750)   ,
		S(507, 714)   ,S(523, 733)   ,S(505, 742)   ,S(496, 756)   ,S(497, 753)   ,S(514, 738)   ,S(520, 723)   ,S(525, 740)   ,
		S(509, 721)   ,S(484, 743)   ,S(489, 761)   ,S(483, 755)   ,S(490, 748)   ,S(495, 755)   ,S(516, 749)   ,S(532, 731)   ,
	},
};
const PScore rookTable[2][64] = {
	{
		S(728, 1252)  ,S(701, 1271)  ,S(679, 1276)  ,S(650, 1281)  ,S(667, 1267)  ,S(709, 1246)  ,S(702, 1251)  ,S(680, 1267)  ,
		S(693, 1249)  ,S(691, 1256)  ,S(701, 1250)  ,S(688, 1258)  ,S(686, 1247)  ,S(690, 1233)  ,S(662, 1241)  ,S(666, 1234)  ,
		S(677, 1242)  ,S(735, 1220)  ,S(706, 1237)  ,S(721, 1214)  ,S(733, 1201)  ,S(702, 1214)  ,S(750, 1192)  ,S(676, 1223)  ,
		S(665, 1236)  ,S(681, 1232)  ,S(701, 1223)  ,S(705, 1221)  ,S(704, 1207)  ,S(691, 1205)  ,S(703, 1201)  ,S(681, 1207)  ,
		S(631, 1221)  ,S(658, 1230)  ,S(635, 1239)  ,S(638, 1233)  ,S(642, 1216)  ,S(647, 1214)  ,S(652, 1217)  ,S(633, 1208)  ,
		S(611, 1192)  ,S(654, 1201)  ,S(630, 1210)  ,S(636, 1207)  ,S(642, 1193)  ,S(642, 1193)  ,S(659, 1194)  ,S(634, 1181)  ,
		S(574, 1198)  ,S(626, 1191)  ,S(641, 1194)  ,S(636, 1197)  ,S(644, 1185)  ,S(651, 1178)  ,S(661, 1172)  ,S(611, 1185)  ,
		S(610, 1198)  ,S(628, 1207)  ,S(655, 1205)  ,S(654, 1194)  ,S(655, 1183)  ,S(665, 1185)  ,S(669, 1184)  ,S(646, 1185)  ,
	},
	{
		S(691, 1313)  ,S(681, 1320)  ,S(674, 1324)  ,S(631, 1327)  ,S(655, 1320)  ,S(634, 1336)  ,S(669, 1325)  ,S(675, 1319)  ,
		S(661, 1295)  ,S(669, 1301)  ,S(696, 1285)  ,S(660, 1314)  ,S(686, 1308)  ,S(666, 1312)  ,S(643, 1322)  ,S(653, 1311)  ,
		S(673, 1278)  ,S(751, 1250)  ,S(733, 1261)  ,S(721, 1255)  ,S(714, 1264)  ,S(677, 1288)  ,S(701, 1273)  ,S(643, 1297)  ,
		S(666, 1270)  ,S(695, 1265)  ,S(699, 1260)  ,S(692, 1264)  ,S(708, 1261)  ,S(679, 1274)  ,S(668, 1275)  ,S(646, 1280)  ,
		S(624, 1259)  ,S(661, 1274)  ,S(641, 1275)  ,S(636, 1270)  ,S(645, 1269)  ,S(628, 1281)  ,S(624, 1284)  ,S(623, 1265)  ,
		S(626, 1220)  ,S(664, 1247)  ,S(643, 1249)  ,S(638, 1245)  ,S(643, 1245)  ,S(623, 1256)  ,S(631, 1259)  ,S(617, 1245)  ,
		S(559, 1235)  ,S(658, 1224)  ,S(653, 1229)  ,S(639, 1235)  ,S(643, 1235)  ,S(631, 1243)  ,S(629, 1237)  ,S(595, 1244)  ,
		S(624, 1216)  ,S(643, 1244)  ,S(654, 1253)  ,S(651, 1235)  ,S(654, 1236)  ,S(643, 1246)  ,S(636, 1246)  ,S(638, 1240)  ,
	},
};
const PScore queenTable[2][64] = {
	{
		S(1350, 2230) ,S(1374, 2243) ,S(1364, 2257) ,S(1331, 2315) ,S(1337, 2302) ,S(1400, 2261) ,S(1366, 2260) ,S(1369, 2233) ,
		S(1353, 2248) ,S(1293, 2308) ,S(1333, 2294) ,S(1275, 2352) ,S(1273, 2364) ,S(1420, 2236) ,S(1321, 2283) ,S(1343, 2248) ,
		S(1347, 2266) ,S(1357, 2234) ,S(1344, 2261) ,S(1343, 2277) ,S(1363, 2282) ,S(1343, 2302) ,S(1385, 2224) ,S(1387, 2249) ,
		S(1360, 2237) ,S(1335, 2298) ,S(1335, 2271) ,S(1326, 2314) ,S(1341, 2302) ,S(1371, 2258) ,S(1394, 2264) ,S(1383, 2243) ,
		S(1349, 2232) ,S(1353, 2282) ,S(1336, 2296) ,S(1346, 2320) ,S(1344, 2296) ,S(1364, 2274) ,S(1380, 2246) ,S(1380, 2230) ,
		S(1340, 2224) ,S(1366, 2228) ,S(1362, 2256) ,S(1362, 2246) ,S(1364, 2234) ,S(1373, 2234) ,S(1389, 2209) ,S(1384, 2207) ,
		S(1320, 2192) ,S(1359, 2179) ,S(1398, 2128) ,S(1388, 2197) ,S(1376, 2193) ,S(1393, 2171) ,S(1399, 2168) ,S(1396, 2173) ,
		S(1343, 2158) ,S(1369, 2133) ,S(1370, 2141) ,S(1378, 2181) ,S(1386, 2180) ,S(1379, 2159) ,S(1369, 2204) ,S(1379, 2155) ,
	},
	{
		S(1370, 2353) ,S(1386, 2376) ,S(1395, 2356) ,S(1324, 2375) ,S(1331, 2373) ,S(1328, 2364) ,S(1337, 2342) ,S(1299, 2353) ,
		S(1365, 2373) ,S(1300, 2438) ,S(1421, 2319) ,S(1259, 2423) ,S(1265, 2411) ,S(1320, 2345) ,S(1265, 2381) ,S(1327, 2324) ,
		S(1327, 2409) ,S(1325, 2400) ,S(1333, 2377) ,S(1336, 2355) ,S(1325, 2348) ,S(1316, 2339) ,S(1327, 2316) ,S(1324, 2322) ,
		S(1361, 2362) ,S(1356, 2397) ,S(1346, 2377) ,S(1307, 2401) ,S(1310, 2381) ,S(1328, 2320) ,S(1334, 2345) ,S(1337, 2304) ,
		S(1366, 2331) ,S(1361, 2338) ,S(1349, 2352) ,S(1327, 2381) ,S(1328, 2388) ,S(1341, 2331) ,S(1353, 2325) ,S(1348, 2287) ,
		S(1371, 2261) ,S(1374, 2279) ,S(1355, 2316) ,S(1350, 2301) ,S(1351, 2313) ,S(1354, 2322) ,S(1368, 2287) ,S(1356, 2266) ,
		S(1349, 2251) ,S(1380, 2207) ,S(1389, 2196) ,S(1371, 2257) ,S(1368, 2275) ,S(1374, 2235) ,S(1366, 2255) ,S(1361, 2249) ,
		S(1356, 2198) ,S(1352, 2216) ,S(1358, 2219) ,S(1380, 2230) ,S(1381, 2267) ,S(1373, 2240) ,S(1367, 2240) ,S(1362, 2246) ,
	},
};
const PScore kingTable[2][64] = {
	{
		S(-35, -188)  ,S(77, -94)    ,S(72, -71)    ,S(92, -47)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-20, -30)   ,S(84, 30)     ,S(131, 17)    ,S(135, 3)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(46, 7)      ,S(107, 49)    ,S(137, 54)    ,S(116, 48)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-18, 18)    ,S(67, 48)     ,S(75, 66)     ,S(55, 74)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-14, -19)   ,S(32, 29)     ,S(44, 55)     ,S(2, 75)      ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-27, -22)   ,S(-26, 10)    ,S(-12, 32)    ,S(-31, 54)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(21, -60)    ,S(-24, -22)   ,S(-55, 11)    ,S(-94, 25)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(25, -152)   ,S(6, -83)     ,S(-45, -41)   ,S(-65, -56)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
	{
		S(9, -189)    ,S(13, 12)     ,S(66, -30)    ,S(83, -42)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-43, -36)   ,S(46, 72)     ,S(141, 11)    ,S(150, 2)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(29, 12)     ,S(178, 53)    ,S(247, 37)    ,S(142, 34)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-41, 19)    ,S(88, 46)     ,S(109, 67)    ,S(66, 74)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-41, -9)    ,S(36, 29)     ,S(38, 63)     ,S(28, 80)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-22, -9)    ,S(-20, 15)    ,S(-10, 45)    ,S(-12, 63)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(26, -48)    ,S(-15, -7)    ,S(-55, 28)    ,S(-79, 33)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(29, -134)   ,S(-1, -57)    ,S(-50, -21)   ,S(-58, -50)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
};

constexpr PScore materialValues[5] = {S(109, 198), S(467, 654), S(477, 698), S(638, 1209), S(1348, 2249), };
constexpr PScore knightMob[9] = {S(-42, -159), S(-23, -85), S(-10, -37), S(-5, -10), S(2, 2), S(7, 16), S(15, 16), S(25, 11), S(35, -14), };
constexpr PScore bishopMob[14] = {S(-62, -204), S(-34, -133), S(-18, -84), S(-10, -53), S(1, -33), S(5, -11), S(9, 4), S(9, 14), S(11, 27), S(17, 30), S(26, 24), S(49, 12), S(60, 18), S(81, -23), };
constexpr PScore rookMob[15] = {S(-26, -141), S(-33, -97), S(-25, -63), S(-24, -45), S(-23, -26), S(-24, -9), S(-21, 1), S(-16, 1), S(-13, 6), S(-5, 11), S(-5, 18), S(0, 23), S(2, 26), S(19, 7), S(80, -29), };
constexpr PScore queenMob[28] = {S(-151, -383), S(-111, -395), S(-72, -309), S(-53, -226), S(-50, -130), S(-47, -73), S(-42, -35), S(-39, -16), S(-36, 5), S(-31, 18), S(-27, 27), S(-22, 33), S(-18, 36), S(-14, 38), S(-12, 40), S(-11, 40), S(-10, 38), S(-14, 37), S(-11, 32), S(-7, 20), S(3, -1), S(11, -23), S(12, -41), S(21, -63), S(6, -76), S(-1, -89), S(-2, -94), S(-55, -12), };

constexpr Score gamephaseInc[12] = { 0, 1, 1, 2, 4, 0, 0, 1, 1, 2, 4, 0 };

//constexpr Score KSAMG = -2;
constexpr double KSCALEMG = 882.80712890625;
constexpr double KSBMG = 1; 
constexpr double KSCMG = -3.074519395828247;
// constexpr Score KSAEG = -71;
constexpr double KSCALEEG = 298.0083312988281;
constexpr double KSBEG = 1;
constexpr double KSCEG = -4.589652061462402;

#define PAWNHASHSIZE 262144ULL

struct PawnEvalHashEntry {
    U64 hash;
    PScore score;
    BitBoard passers; // This can be shrinked to add more stuff and keep the alignement
};

extern PawnEvalHashEntry pawnEvalHash[PAWNHASHSIZE];

extern PScore PSQTs[2][12][64];
/**
* @brief The initTables function initializes the material - positional tables
* @note This function is called once at the beginning of the program
*/
void initTables();

/**
 * @brief The pestoEval function evaluates the material and positional scores
 * @param pos The position to evaluate
 * @return The material and positional scores
 */
Score pestoEval(Position* pos);

/** 
 * @brief The initTropism function initializes the tropism tables
 * @note This is called at the start of the program 
 */
void initTropism();

/**
 * @brief The convertToFeatures function converts a set of positions to a set of features
 * @param filename The filename of the epd file
 * @param output The output file to write the features to
 */
void convertToFeatures(std::string filename, std::string output);