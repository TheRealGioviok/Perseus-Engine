#pragma once

#include "BBmacros.h"
#include "Position.h"

const PScore pawnTable[2][64] = {
	{
		S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,
		S(237, 416)   ,S(213, 425)   ,S(161, 399)   ,S(199, 282)   ,S(217, 161)   ,S(177, 84)    ,S(-6, 154)    ,S(-4, 196)    ,
		S(103, 392)   ,S(130, 381)   ,S(118, 340)   ,S(129, 241)   ,S(169, 151)   ,S(214, 132)   ,S(160, 163)   ,S(107, 204)   ,
		S(118, 285)   ,S(118, 262)   ,S(114, 240)   ,S(115, 207)   ,S(139, 178)   ,S(138, 174)   ,S(84, 205)    ,S(79, 207)    ,
		S(122, 231)   ,S(116, 227)   ,S(118, 213)   ,S(113, 202)   ,S(114, 190)   ,S(103, 196)   ,S(74, 205)    ,S(64, 210)    ,
		S(133, 203)   ,S(150, 199)   ,S(122, 212)   ,S(115, 211)   ,S(103, 206)   ,S(91, 209)    ,S(63, 215)    ,S(62, 216)    ,
		S(133, 197)   ,S(164, 191)   ,S(144, 208)   ,S(99, 223)    ,S(87, 221)    ,S(76, 221)    ,S(59, 225)    ,S(61, 221)    ,
		S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,
	},
	{
		S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,
		S(-34, 254)   ,S(-55, 213)   ,S(178, 132)   ,S(221, 152)   ,S(225, 204)   ,S(201, 281)   ,S(181, 339)   ,S(227, 335)   ,
		S(120, 227)   ,S(153, 217)   ,S(219, 183)   ,S(146, 168)   ,S(137, 183)   ,S(131, 247)   ,S(114, 294)   ,S(101, 314)   ,
		S(98, 219)    ,S(100, 218)   ,S(137, 192)   ,S(133, 185)   ,S(123, 170)   ,S(110, 203)   ,S(108, 221)   ,S(103, 247)   ,
		S(93, 205)    ,S(97, 211)    ,S(116, 205)   ,S(116, 194)   ,S(115, 183)   ,S(108, 188)   ,S(97, 207)    ,S(96, 218)    ,
		S(106, 194)   ,S(120, 202)   ,S(110, 223)   ,S(123, 215)   ,S(111, 193)   ,S(106, 197)   ,S(104, 198)   ,S(100, 208)   ,
		S(109, 174)   ,S(138, 202)   ,S(134, 231)   ,S(99, 232)    ,S(101, 207)   ,S(95, 202)    ,S(99, 201)    ,S(96, 215)    ,
		S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,S(108, 201)   ,
	},
};
const PScore knightTable[2][64] = {
	{
		S(318, 606)   ,S(360, 667)   ,S(382, 707)   ,S(505, 670)   ,S(501, 665)   ,S(393, 695)   ,S(469, 652)   ,S(339, 563)   ,
		S(484, 648)   ,S(505, 672)   ,S(545, 667)   ,S(580, 694)   ,S(569, 686)   ,S(562, 659)   ,S(505, 665)   ,S(525, 636)   ,
		S(457, 675)   ,S(520, 680)   ,S(543, 714)   ,S(547, 715)   ,S(556, 706)   ,S(535, 709)   ,S(508, 678)   ,S(518, 657)   ,
		S(505, 690)   ,S(534, 692)   ,S(560, 714)   ,S(567, 730)   ,S(564, 735)   ,S(551, 721)   ,S(534, 705)   ,S(541, 687)   ,
		S(504, 699)   ,S(528, 699)   ,S(530, 721)   ,S(536, 728)   ,S(549, 729)   ,S(541, 715)   ,S(551, 699)   ,S(528, 698)   ,
		S(463, 662)   ,S(479, 682)   ,S(495, 696)   ,S(497, 719)   ,S(509, 721)   ,S(489, 696)   ,S(493, 674)   ,S(471, 662)   ,
		S(446, 677)   ,S(445, 689)   ,S(464, 671)   ,S(474, 690)   ,S(483, 693)   ,S(475, 676)   ,S(447, 692)   ,S(448, 685)   ,
		S(425, 628)   ,S(432, 676)   ,S(453, 672)   ,S(461, 693)   ,S(460, 684)   ,S(454, 668)   ,S(453, 669)   ,S(422, 664)   ,
	},
	{
		S(347, 583)   ,S(445, 710)   ,S(383, 760)   ,S(498, 729)   ,S(457, 733)   ,S(338, 763)   ,S(349, 718)   ,S(264, 650)   ,
		S(520, 697)   ,S(478, 718)   ,S(569, 705)   ,S(554, 746)   ,S(540, 747)   ,S(515, 710)   ,S(471, 713)   ,S(466, 691)   ,
		S(489, 723)   ,S(475, 752)   ,S(541, 763)   ,S(538, 754)   ,S(526, 756)   ,S(523, 751)   ,S(490, 717)   ,S(459, 697)   ,
		S(516, 747)   ,S(520, 765)   ,S(543, 771)   ,S(539, 790)   ,S(536, 779)   ,S(533, 749)   ,S(517, 723)   ,S(496, 717)   ,
		S(505, 755)   ,S(534, 752)   ,S(523, 763)   ,S(528, 779)   ,S(517, 769)   ,S(513, 754)   ,S(504, 731)   ,S(493, 723)   ,
		S(470, 703)   ,S(482, 719)   ,S(485, 728)   ,S(493, 756)   ,S(495, 754)   ,S(486, 730)   ,S(482, 704)   ,S(469, 674)   ,
		S(458, 721)   ,S(454, 719)   ,S(462, 706)   ,S(473, 728)   ,S(474, 727)   ,S(463, 704)   ,S(458, 711)   ,S(445, 705)   ,
		S(421, 686)   ,S(456, 690)   ,S(458, 713)   ,S(456, 720)   ,S(463, 718)   ,S(460, 688)   ,S(462, 675)   ,S(430, 664)   ,
	},
};
const PScore bishopTable[2][64] = {
	{
		S(464, 773)   ,S(421, 765)   ,S(428, 757)   ,S(395, 764)   ,S(382, 751)   ,S(382, 751)   ,S(519, 746)   ,S(461, 768)   ,
		S(466, 760)   ,S(478, 760)   ,S(508, 749)   ,S(462, 748)   ,S(474, 740)   ,S(527, 721)   ,S(479, 746)   ,S(445, 739)   ,
		S(517, 756)   ,S(536, 749)   ,S(527, 747)   ,S(518, 745)   ,S(536, 731)   ,S(534, 738)   ,S(511, 735)   ,S(520, 745)   ,
		S(515, 755)   ,S(532, 747)   ,S(524, 753)   ,S(529, 754)   ,S(555, 740)   ,S(527, 725)   ,S(538, 741)   ,S(513, 740)   ,
		S(510, 742)   ,S(522, 743)   ,S(523, 748)   ,S(544, 742)   ,S(534, 739)   ,S(528, 733)   ,S(529, 721)   ,S(514, 735)   ,
		S(514, 731)   ,S(543, 734)   ,S(539, 738)   ,S(526, 734)   ,S(527, 735)   ,S(513, 727)   ,S(517, 726)   ,S(502, 734)   ,
		S(528, 719)   ,S(555, 716)   ,S(529, 723)   ,S(514, 730)   ,S(501, 732)   ,S(508, 721)   ,S(507, 712)   ,S(511, 723)   ,
		S(527, 720)   ,S(489, 733)   ,S(502, 739)   ,S(494, 733)   ,S(490, 734)   ,S(490, 744)   ,S(501, 743)   ,S(518, 723)   ,
	},
	{
		S(445, 782)   ,S(475, 771)   ,S(362, 781)   ,S(394, 787)   ,S(367, 809)   ,S(369, 800)   ,S(428, 799)   ,S(448, 807)   ,
		S(460, 776)   ,S(446, 780)   ,S(484, 766)   ,S(461, 774)   ,S(454, 782)   ,S(487, 777)   ,S(473, 790)   ,S(444, 793)   ,
		S(488, 797)   ,S(483, 792)   ,S(494, 796)   ,S(513, 771)   ,S(498, 769)   ,S(516, 772)   ,S(501, 782)   ,S(506, 779)   ,
		S(483, 793)   ,S(508, 786)   ,S(510, 777)   ,S(516, 788)   ,S(520, 783)   ,S(500, 769)   ,S(515, 774)   ,S(487, 785)   ,
		S(497, 767)   ,S(505, 769)   ,S(502, 776)   ,S(520, 779)   ,S(509, 777)   ,S(507, 778)   ,S(507, 761)   ,S(495, 765)   ,
		S(504, 765)   ,S(507, 756)   ,S(503, 763)   ,S(504, 773)   ,S(507, 771)   ,S(507, 768)   ,S(522, 760)   ,S(502, 761)   ,
		S(504, 723)   ,S(519, 740)   ,S(503, 750)   ,S(493, 765)   ,S(492, 762)   ,S(508, 747)   ,S(514, 734)   ,S(517, 752)   ,
		S(506, 729)   ,S(481, 750)   ,S(486, 770)   ,S(479, 762)   ,S(486, 758)   ,S(490, 766)   ,S(510, 761)   ,S(523, 745)   ,
	},
};
const PScore rookTable[2][64] = {
	{
		S(731, 1257)  ,S(704, 1276)  ,S(682, 1283)  ,S(653, 1286)  ,S(663, 1275)  ,S(717, 1251)  ,S(711, 1251)  ,S(685, 1268)  ,
		S(692, 1255)  ,S(692, 1260)  ,S(699, 1257)  ,S(686, 1265)  ,S(684, 1253)  ,S(694, 1239)  ,S(667, 1241)  ,S(668, 1237)  ,
		S(676, 1248)  ,S(737, 1223)  ,S(702, 1247)  ,S(716, 1223)  ,S(728, 1209)  ,S(702, 1222)  ,S(747, 1197)  ,S(679, 1223)  ,
		S(662, 1244)  ,S(679, 1240)  ,S(699, 1232)  ,S(701, 1230)  ,S(700, 1216)  ,S(689, 1216)  ,S(701, 1208)  ,S(681, 1212)  ,
		S(628, 1231)  ,S(656, 1239)  ,S(632, 1250)  ,S(633, 1243)  ,S(637, 1227)  ,S(643, 1225)  ,S(649, 1224)  ,S(630, 1217)  ,
		S(606, 1205)  ,S(649, 1212)  ,S(627, 1222)  ,S(632, 1217)  ,S(637, 1203)  ,S(638, 1204)  ,S(655, 1203)  ,S(630, 1191)  ,
		S(566, 1213)  ,S(621, 1202)  ,S(636, 1208)  ,S(631, 1209)  ,S(639, 1197)  ,S(647, 1189)  ,S(657, 1181)  ,S(608, 1194)  ,
		S(604, 1211)  ,S(623, 1219)  ,S(650, 1216)  ,S(649, 1206)  ,S(650, 1195)  ,S(660, 1197)  ,S(664, 1194)  ,S(641, 1196)  ,
	},
	{
		S(689, 1325)  ,S(692, 1327)  ,S(697, 1331)  ,S(632, 1337)  ,S(658, 1327)  ,S(636, 1343)  ,S(672, 1331)  ,S(677, 1325)  ,
		S(660, 1305)  ,S(669, 1312)  ,S(703, 1299)  ,S(660, 1324)  ,S(686, 1316)  ,S(665, 1320)  ,S(642, 1328)  ,S(651, 1319)  ,
		S(672, 1288)  ,S(748, 1261)  ,S(733, 1277)  ,S(719, 1265)  ,S(714, 1270)  ,S(676, 1296)  ,S(701, 1280)  ,S(643, 1303)  ,
		S(664, 1282)  ,S(691, 1279)  ,S(700, 1276)  ,S(690, 1276)  ,S(706, 1270)  ,S(677, 1283)  ,S(666, 1283)  ,S(643, 1288)  ,
		S(621, 1271)  ,S(658, 1287)  ,S(639, 1291)  ,S(633, 1283)  ,S(643, 1278)  ,S(625, 1291)  ,S(622, 1293)  ,S(621, 1275)  ,
		S(623, 1234)  ,S(661, 1261)  ,S(640, 1264)  ,S(634, 1258)  ,S(640, 1256)  ,S(620, 1267)  ,S(628, 1270)  ,S(614, 1256)  ,
		S(555, 1251)  ,S(652, 1238)  ,S(650, 1246)  ,S(635, 1248)  ,S(639, 1247)  ,S(627, 1255)  ,S(626, 1248)  ,S(592, 1255)  ,
		S(620, 1229)  ,S(640, 1257)  ,S(651, 1267)  ,S(648, 1247)  ,S(650, 1247)  ,S(639, 1258)  ,S(633, 1258)  ,S(635, 1252)  ,
	},
};
const PScore queenTable[2][64] = {
	{
		S(1350, 2248) ,S(1369, 2267) ,S(1364, 2277) ,S(1328, 2340) ,S(1340, 2326) ,S(1398, 2293) ,S(1359, 2292) ,S(1372, 2248) ,
		S(1351, 2270) ,S(1294, 2324) ,S(1334, 2310) ,S(1278, 2370) ,S(1276, 2393) ,S(1416, 2278) ,S(1326, 2299) ,S(1346, 2266) ,
		S(1346, 2286) ,S(1356, 2254) ,S(1343, 2283) ,S(1345, 2294) ,S(1361, 2314) ,S(1345, 2335) ,S(1387, 2250) ,S(1394, 2260) ,
		S(1358, 2262) ,S(1332, 2322) ,S(1335, 2294) ,S(1323, 2341) ,S(1338, 2330) ,S(1369, 2292) ,S(1394, 2286) ,S(1384, 2266) ,
		S(1347, 2258) ,S(1351, 2308) ,S(1334, 2323) ,S(1344, 2345) ,S(1341, 2323) ,S(1361, 2306) ,S(1378, 2271) ,S(1379, 2256) ,
		S(1337, 2253) ,S(1363, 2253) ,S(1361, 2281) ,S(1360, 2272) ,S(1362, 2260) ,S(1371, 2265) ,S(1387, 2235) ,S(1385, 2229) ,
		S(1318, 2217) ,S(1357, 2205) ,S(1396, 2156) ,S(1386, 2222) ,S(1374, 2219) ,S(1391, 2198) ,S(1397, 2191) ,S(1394, 2200) ,
		S(1341, 2187) ,S(1367, 2159) ,S(1366, 2168) ,S(1376, 2205) ,S(1384, 2205) ,S(1377, 2187) ,S(1369, 2225) ,S(1378, 2179) ,
	},
	{
		S(1368, 2379) ,S(1389, 2406) ,S(1364, 2425) ,S(1314, 2422) ,S(1328, 2405) ,S(1323, 2394) ,S(1334, 2370) ,S(1299, 2378) ,
		S(1369, 2394) ,S(1303, 2465) ,S(1395, 2402) ,S(1258, 2468) ,S(1262, 2438) ,S(1319, 2371) ,S(1262, 2409) ,S(1324, 2354) ,
		S(1332, 2434) ,S(1324, 2436) ,S(1330, 2426) ,S(1330, 2403) ,S(1325, 2378) ,S(1316, 2365) ,S(1326, 2347) ,S(1323, 2350) ,
		S(1361, 2394) ,S(1354, 2429) ,S(1341, 2427) ,S(1306, 2436) ,S(1307, 2417) ,S(1327, 2351) ,S(1331, 2376) ,S(1335, 2335) ,
		S(1364, 2365) ,S(1357, 2371) ,S(1345, 2393) ,S(1325, 2414) ,S(1325, 2422) ,S(1338, 2366) ,S(1350, 2358) ,S(1345, 2320) ,
		S(1369, 2297) ,S(1372, 2310) ,S(1353, 2354) ,S(1348, 2335) ,S(1348, 2346) ,S(1351, 2357) ,S(1364, 2322) ,S(1353, 2300) ,
		S(1346, 2286) ,S(1378, 2231) ,S(1387, 2231) ,S(1367, 2291) ,S(1365, 2309) ,S(1372, 2269) ,S(1364, 2290) ,S(1359, 2283) ,
		S(1354, 2230) ,S(1351, 2236) ,S(1355, 2258) ,S(1378, 2262) ,S(1378, 2299) ,S(1371, 2274) ,S(1365, 2273) ,S(1359, 2280) ,
	},
};
const PScore kingTable[2][64] = {
	{
		S(-38, -201)  ,S(75, -102)   ,S(80, -81)    ,S(112, -64)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-17, -45)   ,S(103, 15)    ,S(151, 5)     ,S(158, -14)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(41, -6)     ,S(125, 42)    ,S(160, 44)    ,S(137, 39)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-24, 5)     ,S(90, 41)     ,S(100, 58)    ,S(78, 68)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-26, -30)   ,S(42, 32)     ,S(60, 58)     ,S(12, 79)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-40, -33)   ,S(-23, 17)    ,S(-6, 39)     ,S(-26, 62)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(18, -69)    ,S(-32, -9)    ,S(-59, 21)    ,S(-99, 36)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(21, -163)   ,S(-3, -73)    ,S(-53, -30)   ,S(-72, -46)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
	{
		S(5, -204)    ,S(14, -9)     ,S(59, -44)    ,S(95, -56)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-45, -51)   ,S(56, 50)     ,S(148, -6)    ,S(161, -10)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(13, -2)     ,S(189, 45)    ,S(253, 28)    ,S(153, 30)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-55, 1)     ,S(102, 39)    ,S(126, 61)    ,S(89, 71)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-57, -28)   ,S(46, 33)     ,S(55, 64)     ,S(41, 86)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(-29, -29)   ,S(-16, 23)    ,S(1, 50)      ,S(-6, 71)     ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(30, -64)    ,S(-18, 5)     ,S(-55, 39)    ,S(-80, 45)    ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
		S(32, -150)   ,S(-7, -46)    ,S(-54, -12)   ,S(-61, -39)   ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,S(0, 0)       ,
	},
};

constexpr PScore materialValues[5] = {S(108, 201), S(460, 666), S(471, 707), S(635, 1218), S(1346, 2279), };
constexpr PScore knightMob[9] = {S(-45, -156), S(-26, -80), S(-13, -32), S(-7, -5), S(-1, 7), S(4, 22), S(11, 24), S(21, 20), S(31, -3), };
constexpr PScore bishopMob[14] = {S(-64, -200), S(-37, -129), S(-21, -78), S(-12, -48), S(-1, -26), S(2, -5), S(6, 12), S(6, 23), S(8, 36), S(12, 41), S(20, 38), S(43, 27), S(51, 36), S(69, -2), };
constexpr PScore rookMob[15] = {S(-25, -140), S(-35, -97), S(-26, -62), S(-24, -45), S(-24, -26), S(-24, -8), S(-22, 1), S(-15, 2), S(-12, 7), S(-4, 11), S(-4, 17), S(2, 22), S(3, 26), S(19, 6), S(83, -30), };
constexpr PScore queenMob[28] = {S(-150, -386), S(-111, -396), S(-73, -311), S(-52, -225), S(-50, -131), S(-48, -73), S(-43, -36), S(-39, -17), S(-36, 4), S(-31, 16), S(-26, 26), S(-22, 30), S(-17, 32), S(-13, 36), S(-11, 36), S(-9, 36), S(-10, 35), S(-13, 35), S(-10, 30), S(-8, 20), S(5, -5), S(11, -24), S(11, -40), S(22, -66), S(-4, -67), S(-4, -89), S(-18, -79), S(-46, -26), };

constexpr Score gamephaseInc[12] = { 0, 1, 1, 2, 4, 0, 0, 1, 1, 2, 4, 0 };

//constexpr Score KSAMG = -2;
constexpr double KSCALEMG = 866.7808837890625;
constexpr double KSBMG = 1; 
constexpr double KSCMG = -2.7723097801208496;
// constexpr Score KSAEG = -71;
constexpr double KSCALEEG = 147.00143432617188;
constexpr double KSBEG = 1;
constexpr double KSCEG = -0.5410141944885254;

#define PAWNHASHSIZE 262144ULL

struct PawnEvalHashEntry {
    U64 hash;
    PScore score;
    BitBoard passers; // This can be shrinked to add more stuff and keep the alignement
};

extern PawnEvalHashEntry pawnEvalHash[PAWNHASHSIZE];

extern PScore PSQTs[2][12][64];
/**
* @brief The initTables function initializes the material - positional tables
* @note This function is called once at the beginning of the program
*/
void initTables();

/**
 * @brief The pestoEval function evaluates the material and positional scores
 * @param pos The position to evaluate
 * @return The material and positional scores
 */
Score pestoEval(Position* pos);

/** 
 * @brief The initTropism function initializes the tropism tables
 * @note This is called at the start of the program 
 */
void initTropism();

/**
 * @brief The convertToFeatures function converts a set of positions to a set of features
 * @param filename The filename of the epd file
 * @param output The output file to write the features to
 */
void convertToFeatures(std::string filename, std::string output);